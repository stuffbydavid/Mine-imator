/*
	NOTE:
	This file was autogenerated by CppGen, changes may be overwritten and forever lost!
	Modify at your own risk!
	
	[ Generated on 2023.03.06 18:22:20 ]
*/

#include "Scripts.hpp"

namespace CppProject
{
	void history_restore_parts(Scope<obj_history> self)
	{
		for (IntType t = IntType(0); t < self->part_amount; t++)
		{
			IntType tl = history_restore_tl(self->part_save_obj.Value(t));
			ds_list_add({ idInt(ObjType(obj_timeline, tl)->part_of, part_list), tl });
		}
		for (IntType m = IntType(0); m < self->part_child_amount; m++)
			withOne (Object, save_id_find(self->part_child_save_id.Value(m)), self->id)
				tl_set_parent(self, { save_id_find(ObjType(obj_history, global::history_data)->part_child_parent_save_id.Value(m)), ObjType(obj_history, global::history_data)->part_child_parent_tree_index.Value(m) });
		
		history_restore_tl_select(self);
		if (self->part_amount > IntType(0))
			history_restore_part_usage_tl(global::history_data);
	}
	
	void history_restore_part_usage_tl(VarType hobj)
	{
		IntType tl;
		VarType kfindex;
		withOne (obj_history, hobj, noone)
		{
			for (IntType i = IntType(0); i < self->usage_tl_attractor_amount; i++)
			{
				tl = save_id_find(self->usage_tl_attractor_save_id.Value(i));
				idVar(tl, value)[e_value_ATTRACTOR] = save_id_find(self->usage_tl_attractor_part_save_id.Value(i));
			}
			for (IntType i = IntType(0); i < self->usage_tl_ik_target_amount; i++)
			{
				tl = save_id_find(self->usage_tl_ik_target_save_id.Value(i));
				idVar(tl, value)[e_value_IK_TARGET] = save_id_find(self->usage_tl_ik_target_part_save_id.Value(i));
			}
			for (IntType i = IntType(0); i < self->usage_tl_ik_target_angle_amount; i++)
			{
				tl = save_id_find(self->usage_tl_ik_target_angle_save_id.Value(i));
				idVar(tl, value)[e_value_IK_TARGET_ANGLE] = save_id_find(self->usage_tl_ik_target_angle_part_save_id.Value(i));
			}
			for (IntType i = IntType(0); i < self->usage_kf_attractor_amount; i++)
			{
				tl = save_id_find(self->usage_kf_attractor_tl_save_id.Value(i));
				kfindex = self->usage_kf_attractor_index.Value(i);
				ObjType(obj_keyframe, DsList(idInt(tl, keyframe_list))[kfindex])->value[e_value_ATTRACTOR] = save_id_find(self->usage_kf_attractor_tl_part_save_id.Value(i));
			}
			for (IntType i = IntType(0); i < self->usage_kf_ik_target_amount; i++)
			{
				tl = save_id_find(self->usage_kf_ik_target_tl_save_id.Value(i));
				kfindex = self->usage_kf_ik_target_index.Value(i);
				ObjType(obj_keyframe, DsList(idInt(tl, keyframe_list))[kfindex])->value[e_value_IK_TARGET] = save_id_find(self->usage_kf_ik_target_tl_part_save_id.Value(i));
			}
			for (IntType i = IntType(0); i < self->usage_kf_ik_target_angle_amount; i++)
			{
				tl = save_id_find(self->usage_kf_ik_target_angle_tl_save_id.Value(i));
				kfindex = self->usage_kf_ik_target_angle_index.Value(i);
				ObjType(obj_keyframe, DsList(idInt(tl, keyframe_list))[kfindex])->value[e_value_IK_TARGET_ANGLE] = save_id_find(self->usage_kf_ik_target_tl_part_save_id.Value(i));
			}
		}
		
	}
	
	IntType history_restore_ptype(VarType save, VarType creator)
	{
		IntType ptype;
		ptype = (new obj_particle_type)->id;
		global::save_id_seed--;
		withOne (obj_history_save, save, noone)
			ptype_copy(ScopeAny(self), ptype);
		
		withOne (obj_particle_type, ptype, noone)
		{
			self->save_id = ObjType(obj_history_save, save)->save_id;
			ptype_find_save_ids(self);
			ObjType(obj_particle_type, self->id)->creator = creator;
			ds_list_insert(idInt(ObjType(obj_particle_type, self->id)->creator, pc_type_list), self->creator_index, self->id);
			idInt(self->sprite_tex, count)++;
			idInt(self->sprite_template_tex, count)++;
			ptype_update_sprite_vbuffers(ScopeAny(self));
		}
		
		return ptype;
	}
	
	IntType history_restore_res(IntType save)
	{
		IntType res;
		res = (new obj_resource)->id;
		withOne (obj_history_save, save, noone)
			res_copy(ScopeAny(self), res);
		
		global::save_folder = global::_app->project_folder;
		global::load_folder = global::_app->project_folder;
		withOne (obj_resource, res, noone)
		{
			self->save_id = ObjType(obj_history_save, save)->save_id;
			res_load(ScopeAny(self));
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_model_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_model_save_id.Value(s)), self->id)
				{
					if (sVar(model) != null_)
						idInt(sVar(model), count)--;
					sVar(model) = res;
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_model_tex_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_model_tex_save_id.Value(s)), self->id)
				{
					idInt(sVar(model_tex), count)--;
					sVar(model_tex) = res;
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_model_tex_material_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_model_tex_material_save_id.Value(s)), self->id)
				{
					idInt(sVar(model_tex_material), count)--;
					sVar(model_tex_material) = res;
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_model_tex_normal_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_model_tex_normal_save_id.Value(s)), self->id)
				{
					idInt(sVar(model_tex_normal), count)--;
					sVar(model_tex_normal) = res;
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_item_tex_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_item_tex_save_id.Value(s)), self->id)
				{
					idInt(sVar(item_tex), count)--;
					sVar(item_tex) = res;
					render_generate_item(self);
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_item_tex_material_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_item_tex_material_save_id.Value(s)), self->id)
				{
					idInt(sVar(item_tex_material), count)--;
					sVar(item_tex_material) = res;
					render_generate_item(self);
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_item_tex_normal_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_item_tex_normal_save_id.Value(s)), self->id)
				{
					idInt(sVar(item_tex_normal), count)--;
					sVar(item_tex_normal) = res;
					render_generate_item(self);
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_block_tex_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_block_tex_save_id.Value(s)), self->id)
				{
					idInt(sVar(block_tex), count)--;
					sVar(block_tex) = res;
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_block_tex_material_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_block_tex_material_save_id.Value(s)), self->id)
				{
					idInt(sVar(block_tex_material), count)--;
					sVar(block_tex_material) = res;
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_block_tex_normal_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_block_tex_normal_save_id.Value(s)), self->id)
				{
					idInt(sVar(block_tex_normal), count)--;
					sVar(block_tex_normal) = res;
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_scenery_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_scenery_save_id.Value(s)), self->id)
					sVar(scenery) = res;
			
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_shape_tex_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_shape_tex_save_id.Value(s)), self->id)
					sVar(shape_tex) = res;
			
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_shape_tex_material_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_shape_tex_material_save_id.Value(s)), self->id)
					sVar(shape_tex_material) = res;
			
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_shape_tex_normal_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_shape_tex_normal_save_id.Value(s)), self->id)
					sVar(shape_tex_normal) = res;
			
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_text_font_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_text_font_save_id.Value(s)), self->id)
				{
					idInt(sVar(text_font), count)--;
					sVar(text_font) = res;
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_sprite_tex_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_sprite_tex_save_id.Value(s)), self->id)
					sVar(sprite_tex) = res;
			
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_sprite_template_tex_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_sprite_template_tex_save_id.Value(s)), self->id)
					sVar(sprite_template_tex) = res;
			
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_kf_texture_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_kf_texture_tl_save_id.Value(s)), self->id)
					ObjType(obj_keyframe, DsList(sInt(keyframe_list))[ObjType(obj_history_save, save)->usage_kf_texture_index.Value(s)])->value[e_value_TEXTURE_OBJ] = res;
			
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_kf_sound_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_kf_sound_tl_save_id.Value(s)), self->id)
					ObjType(obj_keyframe, DsList(sInt(keyframe_list))[ObjType(obj_history_save, save)->usage_kf_sound_index.Value(s)])->value[e_value_SOUND_OBJ] = res;
			
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_kf_text_font_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_kf_text_font_tl_save_id.Value(s)), self->id)
					ObjType(obj_keyframe, DsList(sInt(keyframe_list))[ObjType(obj_history_save, save)->usage_kf_text_font_index.Value(s)])->value[e_value_TEXT_FONT] = res;
			
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_tl_texture_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_tl_texture_save_id.Value(s)), self->id)
				{
					sVar(value)[e_value_TEXTURE_OBJ] = res;
					sBool(update_matrix) = true;
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_tl_sound_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_tl_sound_save_id.Value(s)), self->id)
				{
					sVar(value)[e_value_SOUND_OBJ] = res;
					sBool(update_matrix) = true;
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_tl_text_font_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_tl_text_font_save_id.Value(s)), self->id)
				{
					sVar(value)[e_value_TEXT_FONT] = res;
					sBool(update_matrix) = true;
				}
				
			}
			if (ObjType(obj_history_save, save)->usage_background_image)
				global::_app->background_image = res;
			if (ObjType(obj_history_save, save)->usage_background_sky_sun_tex)
			{
				idInt(global::_app->background_sky_sun_tex, count)--;
				global::_app->background_sky_sun_tex = res;
			}
			if (ObjType(obj_history_save, save)->usage_background_sky_moon_tex)
			{
				idInt(global::_app->background_sky_moon_tex, count)--;
				global::_app->background_sky_moon_tex = res;
			}
			if (ObjType(obj_history_save, save)->usage_background_sky_clouds_tex)
			{
				idInt(global::_app->background_sky_clouds_tex, count)--;
				global::_app->background_sky_clouds_tex = res;
			}
			if (ObjType(obj_history_save, save)->usage_background_ground_tex)
			{
				withOne (app, global::_app->id, self->id)
				{
					idInt(global::_app->background_ground_tex, count)--;
					global::_app->background_ground_tex = res;
					background_ground_update_texture(ScopeAny(self));
				}
				
			}
			if (ObjType(obj_history_save, save)->usage_background_ground_tex_material)
			{
				withOne (app, global::_app->id, self->id)
				{
					idInt(global::_app->background_ground_tex_material, count)--;
					global::_app->background_ground_tex_material = res;
					background_ground_update_texture_material(ScopeAny(self));
				}
				
			}
			if (ObjType(obj_history_save, save)->usage_background_ground_tex_normal)
			{
				withOne (app, global::_app->id, self->id)
				{
					idInt(global::_app->background_ground_tex_normal, count)--;
					global::_app->background_ground_tex_normal = res;
					background_ground_update_texture_normal(ScopeAny(self));
				}
				
			}
			self->count += ObjType(obj_history_save, save)->usage_model_amount;
			self->count += ObjType(obj_history_save, save)->usage_model_tex_amount;
			self->count += ObjType(obj_history_save, save)->usage_model_tex_material_amount;
			self->count += ObjType(obj_history_save, save)->usage_model_tex_normal_amount;
			self->count += ObjType(obj_history_save, save)->usage_item_tex_amount;
			self->count += ObjType(obj_history_save, save)->usage_block_tex_amount;
			self->count += ObjType(obj_history_save, save)->usage_block_tex_material_amount;
			self->count += ObjType(obj_history_save, save)->usage_block_tex_normal_amount;
			self->count += ObjType(obj_history_save, save)->usage_scenery_amount;
			self->count += ObjType(obj_history_save, save)->usage_shape_tex_amount;
			self->count += ObjType(obj_history_save, save)->usage_text_font_amount;
			self->count += ObjType(obj_history_save, save)->usage_sprite_tex_amount;
			self->count += ObjType(obj_history_save, save)->usage_sprite_template_tex_amount;
			self->count += ObjType(obj_history_save, save)->usage_kf_sound_amount;
			self->count += ObjType(obj_history_save, save)->usage_background_image;
			self->count += ObjType(obj_history_save, save)->usage_background_sky_sun_tex;
			self->count += ObjType(obj_history_save, save)->usage_background_sky_moon_tex;
			self->count += ObjType(obj_history_save, save)->usage_background_sky_clouds_tex;
			self->count += ObjType(obj_history_save, save)->usage_background_ground_tex;
		}
		
		sortlist_add(global::_app->res_list, res);
		return res;
	}
	
	IntType history_restore_temp(IntType save)
	{
		IntType temp;
		temp = (new obj_template)->id;
		withOne (obj_history_save, save, noone)
			temp_copy(ScopeAny(self), temp);
		
		withOne (obj_template, temp, noone)
		{
			self->save_id = ObjType(obj_history_save, save)->save_id;
			temp_find_save_ids(ScopeAny(self));
			if (self->model != null_)
				idInt(self->model, count)++;
			if (self->model_tex != null_)
				idInt(self->model_tex, count)++;
			if (self->model_tex_material != null_)
				idInt(self->model_tex_material, count)++;
			if (self->model_tex_normal != null_)
				idInt(self->model_tex_normal, count)++;
			if (self->item_tex != null_)
				idInt(self->item_tex, count)++;
			if (self->item_tex_material != null_)
				idInt(self->item_tex_material, count)++;
			if (self->item_tex_normal != null_)
				idInt(self->item_tex_normal, count)++;
			if (self->block_tex != null_)
				idInt(self->block_tex, count)++;
			if (self->block_tex_material != null_)
				idInt(self->block_tex_material, count)++;
			if (self->block_tex_normal != null_)
				idInt(self->block_tex_normal, count)++;
			if (self->scenery != null_)
				idInt(self->scenery, count)++;
			if (self->shape_tex != null_ && idVar(self->shape_tex, type) != e_tl_type_CAMERA)
				idInt(self->shape_tex, count)++;
			if (self->shape_tex_material != null_)
				idInt(self->shape_tex_material, count)++;
			if (self->shape_tex_normal != null_)
				idInt(self->shape_tex_normal, count)++;
			if (self->text_font != null_)
				idInt(self->text_font, count)++;
			temp_update(ScopeAny(self));
			if (self->type == e_temp_type_PARTICLE_SPAWNER)
			{
				self->pc_type_list = ds_list_create();
				for (IntType p = IntType(0); p < ObjType(obj_history_save, save)->pc_type_amount; p++)
					history_restore_ptype(ObjType(obj_history_save, save)->pc_type_save_obj.Value(p), self->id);
				temp_particles_restart(ScopeAny(self));
			}
			for (IntType t = IntType(0); t < ObjType(obj_history_save, save)->usage_ptype_temp_amount; t++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_ptype_temp_save_id.Value(t)), self->id)
					idVar(self->id, temp) = temp;
			
			for (IntType t = IntType(0); t < ObjType(obj_history_save, save)->usage_tl_amount; t++)
				history_restore_tl(ObjType(obj_history_save, save)->usage_tl_save_obj.Value(t));
		}
		
		sortlist_add(global::_app->lib_list, temp);
		return temp;
	}
	
	IntType history_restore_tl(VarType save, IntType tl)
	{
		if (tl == null_)
			tl = (new obj_timeline)->id;
		withOne (obj_history_save, save, noone)
			tl_copy(ScopeAny(self), tl);
		
		withOne (obj_timeline, tl, noone)
		{
			self->save_id = ObjType(obj_history_save, save)->save_id;
			tl_find_save_ids(self);
			if (self->temp != null_ && self->part_of == null_)
				idInt(self->temp, count)++;
			for (IntType v = IntType(0); v < e_value_amount; v++)
				self->value_default[v] = tl_value_find_save_id(v, null_, ObjType(obj_history_save, save)->value_default.Value(v));
			for (IntType k = IntType(0); k < ObjType(obj_history_save, save)->kf_amount; k++)
			{
				withOne (obj_keyframe, (new obj_keyframe)->id, self->id)
				{
					self->position = ObjType(obj_history_save, save)->kf_pos.Value(k);
					self->timeline = tl;
					self->selected = false;
					self->sound_play_index = null_;
					for (IntType v = IntType(0); v < e_value_amount; v++)
						self->value[v] = tl_value_find_save_id(v, null_, ObjType(obj_history_save, save)->kf_value[k][v]);
					ds_list_add({ ObjType(obj_timeline, self.otherId)->keyframe_list, self->id });
				}
				
			}
			ds_list_insert(idInt(self->parent, tree_list), (IntType)(self->parent_tree_index), self->id);
			if (ObjType(obj_history_save, save)->pattern_type != /*""*/ STR(0))
			{
				self->pattern_type = ObjType(obj_history_save, save)->pattern_type;
				self->pattern_base_color = ObjType(obj_history_save, save)->pattern_base_color;
				self->pattern_pattern_list = array_copy_1d(ObjType(obj_history_save, save)->pattern_pattern_list);
				self->pattern_color_list = array_copy_1d(ObjType(obj_history_save, save)->pattern_color_list);
				array_add(VarType::CreateRef(global::pattern_update), self->id);
			}
			tl_update_scenery_part(ScopeAny(self));
			tl_update(ScopeAny(self));
			tl_update_values(ScopeAny(self));
			for (IntType t = IntType(0); t < ObjType(obj_history_save, save)->tree_amount; t++)
				history_restore_tl(ObjType(obj_history_save, save)->tree_save_obj.Value(t));
			if (ObjType(obj_history_save, save)->part_amount > IntType(0))
				self->part_list = ds_list_create();
			for (IntType p = IntType(0); p < ObjType(obj_history_save, save)->part_amount; p++)
				ds_list_add({ self->part_list, save_id_find(ObjType(obj_history_save, save)->part_save_id.Value(p)) });
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_temp_shape_tex_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_temp_shape_tex_save_id.Value(s)), self->id)
					sVar(shape_tex) = tl;
			
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_temp_path_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_temp_path_save_id.Value(s)), self->id)
					sVar(pc_spawn_region_path) = tl;
			
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_tl_texture_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_tl_texture_save_id.Value(s)), self->id)
				{
					sVar(value)[e_value_TEXTURE_OBJ] = tl;
					sBool(update_matrix) = true;
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_tl_path_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_tl_path_save_id.Value(s)), self->id)
				{
					sVar(value)[e_value_PATH_OBJ] = tl;
					sBool(update_matrix) = true;
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_tl_attractor_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_tl_attractor_save_id.Value(s)), self->id)
				{
					sVar(value)[e_value_ATTRACTOR] = tl;
					sBool(update_matrix) = true;
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_tl_ik_target_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_tl_ik_target_save_id.Value(s)), self->id)
				{
					sVar(value)[e_value_IK_TARGET] = tl;
					sBool(update_matrix) = true;
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_tl_ik_target_angle_amount; s++)
			{
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_tl_ik_target_angle_save_id.Value(s)), self->id)
				{
					sVar(value)[e_value_IK_TARGET_ANGLE] = tl;
					sBool(update_matrix) = true;
				}
				
			}
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_kf_texture_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_kf_texture_tl_save_id.Value(s)), self->id)
					ObjType(obj_keyframe, DsList(sInt(keyframe_list))[ObjType(obj_history_save, save)->usage_kf_texture_index.Value(s)])->value[e_value_TEXTURE_OBJ] = tl;
			
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_kf_path_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_kf_path_tl_save_id.Value(s)), self->id)
					ObjType(obj_keyframe, DsList(sInt(keyframe_list))[ObjType(obj_history_save, save)->usage_kf_path_index.Value(s)])->value[e_value_PATH_OBJ] = tl;
			
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_kf_attractor_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_kf_attractor_tl_save_id.Value(s)), self->id)
					ObjType(obj_keyframe, DsList(sInt(keyframe_list))[ObjType(obj_history_save, save)->usage_kf_attractor_index.Value(s)])->value[e_value_ATTRACTOR] = tl;
			
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_kf_ik_target_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_kf_ik_target_tl_save_id.Value(s)), self->id)
					ObjType(obj_keyframe, DsList(sInt(keyframe_list))[ObjType(obj_history_save, save)->usage_kf_ik_target_index.Value(s)])->value[e_value_IK_TARGET] = tl;
			
			for (IntType s = IntType(0); s < ObjType(obj_history_save, save)->usage_kf_ik_target_angle_amount; s++)
				withOne (Object, save_id_find(ObjType(obj_history_save, save)->usage_kf_ik_target_angle_tl_save_id.Value(s)), self->id)
					ObjType(obj_keyframe, DsList(sInt(keyframe_list))[ObjType(obj_history_save, save)->usage_kf_ik_target_angle_index.Value(s)])->value[e_value_IK_TARGET_ANGLE] = tl;
			
		}
		
		return tl;
	}
	
	void history_restore_tl_select(Scope<obj_history> self)
	{
		tl_deselect_all();
		for (IntType t = IntType(0); t < self->tl_sel_amount; t++)
		{
			withOne (Object, save_id_find(self->tl_sel_save_id.Value(t)), self->id)
			{
				tl_select(self);
				for (IntType k = IntType(0); k < ObjType(obj_history, self.otherId)->tl_sel_kf_amount.Value(t); k++)
					tl_keyframe_select(DsList(sInt(keyframe_list)).Value(ObjType(obj_history, self.otherId)->tl_sel_kf_index[t][k]));
			}
			
		}
	}
	
	void history_restore_tl_select_new(Scope<obj_history> self)
	{
		tl_deselect_all();
		for (IntType t = IntType(0); t < self->tl_sel_new_amount; t++)
		{
			withOne (Object, save_id_find(self->tl_sel_new_save_id.Value(t)), self->id)
			{
				tl_select(self);
				for (IntType k = IntType(0); k < ObjType(obj_history, self.otherId)->tl_sel_new_kf_amount.Value(t); k++)
					tl_keyframe_select(DsList(sInt(keyframe_list)).Value(ObjType(obj_history, self.otherId)->tl_sel_new_kf_index[t][k]));
			}
			
		}
	}
	
	IntType history_save_bench(ScopeAny self)
	{
		IntType save = (new obj_history_save)->id;
		ObjType(obj_history_save, save)->hobj = self->id;
		withOne (obj_bench_settings, sInt(bench_settings), self->id)
			temp_copy(ScopeAny(self), save);
		
		withOne (obj_history_save, save, self->id)
		{
			temp_get_save_ids(self);
			if (self->type == e_temp_type_PARTICLE_SPAWNER)
			{
				ObjType(obj_history_save, save)->pc_type_amount = ds_list_size(ObjType(obj_bench_settings, global::_app->bench_settings)->pc_type_list);
				for (IntType p = IntType(0); p < ObjType(obj_history_save, save)->pc_type_amount; p++)
					withOne (Object, self.otherId, self->id)
						ObjType(obj_history_save, save)->pc_type_save_obj[p] = history_save_ptype(self, DsList(ObjType(obj_bench_settings, global::_app->bench_settings)->pc_type_list).Value(p));
				
			}
			self->temp_amount = IntType(0);
			withAll (obj_template, self->id)
			{
				if (self->creator != global::_app->bench_settings)
					continue;
				IntType tsave = (new obj_history_save)->id;
				ObjType(obj_history_save, tsave)->hobj = ObjType(obj_history_save, save)->hobj;
				temp_copy(ScopeAny(self), tsave);
				withOne (obj_history_save, tsave, self->id)
				{
					self->save_id = ObjType(obj_template, self.otherId)->save_id;
					temp_get_save_ids(self);
				}
				
				ObjType(obj_history_save, save)->temp_save_obj[ObjType(obj_history_save, save)->temp_amount] = tsave;
				ObjType(obj_history_save, save)->temp_amount++;
			}
			
		}
		
		return save;
	}
	
	void history_save_keyframes(Scope<obj_history> self)
	{
		self->save_kf_amount = IntType(0);
		withAll (obj_keyframe, self->id)
		{
			if (!(self->selected > 0))
				continue;
			ObjType(obj_history, self.otherId)->save_kf_tl_save_id[ObjType(obj_history, self.otherId)->save_kf_amount] = save_id_get(self->timeline);
			ObjType(obj_history, self.otherId)->save_kf_pos[ObjType(obj_history, self.otherId)->save_kf_amount] = self->position;
			for (IntType v = IntType(0); v < e_value_amount; v++)
				ObjType(obj_history, self.otherId)->save_kf_value[ObjType(obj_history, self.otherId)->save_kf_amount][v] = tl_value_get_save_id(v, self->value.Value(v));
			ObjType(obj_history, self.otherId)->save_kf_amount++;
		}
		
	}
	
	void history_save_loaded(Scope<obj_history> self)
	{
		self->loaded_amount = IntType(0);
		withAll (obj_template, self->id)
			if (self->loaded)
				ObjType(obj_history, self.otherId)->loaded_save_id[ObjType(obj_history, self.otherId)->loaded_amount++] = self->save_id;
		
		withAll (obj_timeline, self->id)
			if (self->loaded)
				ObjType(obj_history, self.otherId)->loaded_save_id[ObjType(obj_history, self.otherId)->loaded_amount++] = self->save_id;
		
		withAll (obj_resource, self->id)
			if (self->loaded)
				ObjType(obj_history, self.otherId)->loaded_save_id[ObjType(obj_history, self.otherId)->loaded_amount++] = self->save_id;
		
	}
	
	BoolType history_save_part_usage_tl(IntType tl, VarType hobj)
	{
		BoolType used = false;
		withAll (obj_timeline, noone)
		{
			if (self->value.Value(e_value_ATTRACTOR) == tl)
			{
				idArr(hobj, usage_tl_attractor_save_id)[idInt(hobj, usage_tl_attractor_amount)] = self->save_id;
				idArr(hobj, usage_tl_attractor_part_save_id)[idInt(hobj, usage_tl_attractor_amount)] = idVar(tl, save_id);
				idInt(hobj, usage_tl_attractor_amount)++;
				used = true;
			}
			if (self->value.Value(e_value_IK_TARGET) == tl)
			{
				idArr(hobj, usage_tl_ik_target_save_id)[idInt(hobj, usage_tl_ik_target_amount)] = self->save_id;
				idArr(hobj, usage_tl_ik_target_part_save_id)[idInt(hobj, usage_tl_ik_target_amount)] = idVar(tl, save_id);
				idInt(hobj, usage_tl_ik_target_amount)++;
				used = true;
			}
			if (self->value.Value(e_value_IK_TARGET_ANGLE) == tl)
			{
				idArr(hobj, usage_tl_ik_target_angle_save_id)[idInt(hobj, usage_tl_ik_target_angle_amount)] = self->save_id;
				idArr(hobj, usage_tl_ik_target_angle_part_save_id)[idInt(hobj, usage_tl_ik_target_angle_amount)] = idVar(tl, save_id);
				idInt(hobj, usage_tl_ik_target_angle_amount)++;
				used = true;
			}
		}
		
		withAll (obj_keyframe, noone)
		{
			if (self->value.Value(e_value_IK_TARGET) == tl)
			{
				idArr(hobj, usage_kf_ik_target_tl_save_id)[idInt(hobj, usage_kf_ik_target_amount)] = save_id_get(self->timeline);
				idArr(hobj, usage_kf_ik_target_tl_part_save_id)[idInt(hobj, usage_kf_ik_target_amount)] = idVar(tl, save_id);
				idArr(hobj, usage_kf_ik_target_index)[idInt(hobj, usage_kf_ik_target_amount)] = ds_list_find_index(idInt(self->timeline, keyframe_list), self->id);
				idInt(hobj, usage_kf_ik_target_amount)++;
				used = true;
			}
			if (self->value.Value(e_value_IK_TARGET_ANGLE) == tl)
			{
				idArr(hobj, usage_kf_ik_target_angle_tl_save_id)[idInt(hobj, usage_kf_ik_target_angle_amount)] = save_id_get(self->timeline);
				idVar(hobj, usage_kf_ik_target_angle_tl_part_save_id)[idInt(hobj, usage_kf_ik_target_angle_amount)] = idVar(tl, save_id);
				idArr(hobj, usage_kf_ik_target_angle_index)[idInt(hobj, usage_kf_ik_target_angle_amount)] = ds_list_find_index(idInt(self->timeline, keyframe_list), self->id);
				idInt(hobj, usage_kf_ik_target_angle_amount)++;
				used = true;
			}
			if (self->value.Value(e_value_ATTRACTOR) == tl)
			{
				idArr(hobj, usage_kf_attractor_tl_save_id)[idInt(hobj, usage_kf_attractor_amount)] = save_id_get(self->timeline);
				idArr(hobj, usage_kf_attractor_tl_part_save_id)[idInt(hobj, usage_kf_attractor_amount)] = idVar(tl, save_id);
				idArr(hobj, usage_kf_attractor_index)[idInt(hobj, usage_kf_attractor_amount)] = ds_list_find_index(idInt(self->timeline, keyframe_list), self->id);
				idInt(hobj, usage_kf_attractor_amount)++;
				used = true;
			}
		}
		
		return used;
	}
	
	IntType history_save_ptype(ScopeAny self, VarType ptype)
	{
		IntType save;
		save = (new obj_history_save)->id;
		ObjType(obj_history_save, save)->hobj = self->id;
		withOne (Object, ptype, self->id)
			ptype_copy(self, save);
		
		withOne (obj_history_save, save, self->id)
		{
			self->save_id = idVar(ptype, save_id);
			ptype_get_save_ids(self);
		}
		
		return save;
	}
	
	IntType history_save_res(Scope<obj_history> self, VarType res)
	{
		IntType save = (new obj_history_save)->id;
		ObjType(obj_history_save, save)->hobj = self->id;
		withOne (Object, res, self->id)
			res_copy(self, save);
		
		withOne (obj_history_save, save, self->id)
		{
			self->save_id = idVar(res, save_id);
			self->usage_model_amount = IntType(0);
			self->usage_model_tex_amount = IntType(0);
			self->usage_model_tex_material_amount = IntType(0);
			self->usage_model_tex_normal_amount = IntType(0);
			self->usage_item_tex_amount = IntType(0);
			self->usage_item_tex_material_amount = IntType(0);
			self->usage_item_tex_normal_amount = IntType(0);
			self->usage_block_tex_amount = IntType(0);
			self->usage_block_tex_material_amount = IntType(0);
			self->usage_block_tex_normal_amount = IntType(0);
			self->usage_scenery_amount = IntType(0);
			self->usage_shape_tex_amount = IntType(0);
			self->usage_shape_tex_material_amount = IntType(0);
			self->usage_shape_tex_normal_amount = IntType(0);
			self->usage_text_font_amount = IntType(0);
			self->usage_sprite_tex_amount = IntType(0);
			self->usage_sprite_template_tex_amount = IntType(0);
			self->usage_kf_texture_amount = IntType(0);
			self->usage_tl_texture_amount = IntType(0);
			self->usage_kf_sound_amount = IntType(0);
			self->usage_tl_sound_amount = IntType(0);
			self->usage_kf_text_font_amount = IntType(0);
			self->usage_tl_text_font_amount = IntType(0);
			self->usage_background_image = false;
			self->usage_background_sky_sun_tex = false;
			self->usage_background_sky_moon_tex = false;
			self->usage_background_sky_clouds_tex = false;
			self->usage_background_ground_tex = false;
			self->usage_background_ground_tex_material = false;
			self->usage_background_ground_tex_normal = false;
		}
		
		withAll (obj_template, self->id)
		{
			if (self->model == res)
			{
				ObjType(obj_history_save, save)->usage_model_save_id[ObjType(obj_history_save, save)->usage_model_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_model_amount++;
			}
			if (self->model_tex == res)
			{
				ObjType(obj_history_save, save)->usage_model_tex_save_id[ObjType(obj_history_save, save)->usage_model_tex_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_model_tex_amount++;
			}
			if (self->model_tex_material == res)
			{
				ObjType(obj_history_save, save)->usage_model_tex_material_save_id[ObjType(obj_history_save, save)->usage_model_tex_material_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_model_tex_material_amount++;
			}
			if (self->model_tex_normal == res)
			{
				ObjType(obj_history_save, save)->usage_model_tex_normal_save_id[ObjType(obj_history_save, save)->usage_model_tex_normal_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_model_tex_normal_amount++;
			}
			if (self->item_tex == res)
			{
				ObjType(obj_history_save, save)->usage_item_tex_save_id[ObjType(obj_history_save, save)->usage_item_tex_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_item_tex_amount++;
			}
			if (self->item_tex_material == res)
			{
				ObjType(obj_history_save, save)->usage_item_tex_material_save_id[ObjType(obj_history_save, save)->usage_item_tex_material_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_item_tex_material_amount++;
			}
			if (self->item_tex_normal == res)
			{
				ObjType(obj_history_save, save)->usage_item_tex_normal_save_id[ObjType(obj_history_save, save)->usage_item_tex_normal_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_item_tex_normal_amount++;
			}
			if (self->block_tex == res)
			{
				ObjType(obj_history_save, save)->usage_block_tex_save_id[ObjType(obj_history_save, save)->usage_block_tex_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_block_tex_amount++;
			}
			if (self->block_tex_material == res)
			{
				ObjType(obj_history_save, save)->usage_block_tex_material_save_id[ObjType(obj_history_save, save)->usage_block_tex_material_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_block_tex_material_amount++;
			}
			if (self->block_tex_normal == res)
			{
				ObjType(obj_history_save, save)->usage_block_tex_normal_save_id[ObjType(obj_history_save, save)->usage_block_tex_normal_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_block_tex_normal_amount++;
			}
			if (self->scenery == res)
			{
				ObjType(obj_history_save, save)->usage_scenery_save_id[ObjType(obj_history_save, save)->usage_scenery_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_scenery_amount++;
			}
			if (self->shape_tex == res)
			{
				ObjType(obj_history_save, save)->usage_shape_tex_save_id[ObjType(obj_history_save, save)->usage_shape_tex_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_shape_tex_amount++;
			}
			if (self->shape_tex_material == res)
			{
				ObjType(obj_history_save, save)->usage_shape_tex_material_save_id[ObjType(obj_history_save, save)->usage_shape_tex_material_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_shape_tex_material_amount++;
			}
			if (self->shape_tex_normal == res)
			{
				ObjType(obj_history_save, save)->usage_shape_tex_normal_save_id[ObjType(obj_history_save, save)->usage_shape_tex_normal_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_shape_tex_normal_amount++;
			}
			if (self->text_font == res)
			{
				ObjType(obj_history_save, save)->usage_text_font_save_id[ObjType(obj_history_save, save)->usage_text_font_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_text_font_amount++;
			}
		}
		
		withAll (obj_particle_type, self->id)
		{
			if (self->sprite_tex == res)
			{
				ObjType(obj_history_save, save)->usage_sprite_tex_save_id[ObjType(obj_history_save, save)->usage_sprite_tex_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_sprite_tex_amount++;
			}
			if (self->sprite_template_tex == res)
			{
				ObjType(obj_history_save, save)->usage_sprite_template_tex_save_id[ObjType(obj_history_save, save)->usage_sprite_template_tex_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_sprite_template_tex_amount++;
			}
		}
		
		withAll (obj_keyframe, self->id)
		{
			if (self->value.Value(e_value_TEXTURE_OBJ) == res)
			{
				ObjType(obj_history_save, save)->usage_kf_texture_tl_save_id[ObjType(obj_history_save, save)->usage_kf_texture_amount] = save_id_get(self->timeline);
				ObjType(obj_history_save, save)->usage_kf_texture_index[ObjType(obj_history_save, save)->usage_kf_texture_amount] = ds_list_find_index(idInt(self->timeline, keyframe_list), self->id);
				ObjType(obj_history_save, save)->usage_kf_texture_amount++;
			}
			if (self->value.Value(e_value_SOUND_OBJ) == res)
			{
				ObjType(obj_history_save, save)->usage_kf_sound_tl_save_id[ObjType(obj_history_save, save)->usage_kf_sound_amount] = save_id_get(self->timeline);
				ObjType(obj_history_save, save)->usage_kf_sound_index[ObjType(obj_history_save, save)->usage_kf_sound_amount] = ds_list_find_index(idInt(self->timeline, keyframe_list), self->id);
				ObjType(obj_history_save, save)->usage_kf_sound_amount++;
			}
			if (self->value.Value(e_value_TEXT_FONT) == res)
			{
				ObjType(obj_history_save, save)->usage_kf_text_font_tl_save_id[ObjType(obj_history_save, save)->usage_kf_text_font_amount] = save_id_get(self->timeline);
				ObjType(obj_history_save, save)->usage_kf_text_font_index[ObjType(obj_history_save, save)->usage_kf_text_font_amount] = ds_list_find_index(idInt(self->timeline, keyframe_list), self->id);
				ObjType(obj_history_save, save)->usage_kf_text_font_amount++;
			}
		}
		
		withAll (obj_timeline, self->id)
		{
			if (self->value.Value(e_value_TEXTURE_OBJ) == res)
			{
				ObjType(obj_history_save, save)->usage_tl_texture_save_id[ObjType(obj_history_save, save)->usage_tl_texture_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_tl_texture_amount++;
			}
			if (self->value.Value(e_value_SOUND_OBJ) == res)
			{
				ObjType(obj_history_save, save)->usage_tl_sound_save_id[ObjType(obj_history_save, save)->usage_tl_sound_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_tl_sound_amount++;
			}
			if (self->value.Value(e_value_TEXT_FONT) == res)
			{
				ObjType(obj_history_save, save)->usage_tl_text_font_save_id[ObjType(obj_history_save, save)->usage_tl_text_font_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_tl_text_font_amount++;
			}
		}
		
		withOne (app, global::_app->id, self->id)
		{
			if (global::_app->background_image == res)
				ObjType(obj_history_save, save)->usage_background_image = true;
			if (global::_app->background_sky_sun_tex == res)
				ObjType(obj_history_save, save)->usage_background_sky_sun_tex = true;
			if (global::_app->background_sky_moon_tex == res)
				ObjType(obj_history_save, save)->usage_background_sky_moon_tex = true;
			if (global::_app->background_sky_clouds_tex == res)
				ObjType(obj_history_save, save)->usage_background_sky_clouds_tex = true;
			if (global::_app->background_ground_tex == res)
				ObjType(obj_history_save, save)->usage_background_ground_tex = true;
			if (global::_app->background_ground_tex_material == res)
				ObjType(obj_history_save, save)->usage_background_ground_tex_material = true;
			if (global::_app->background_ground_tex_normal == res)
				ObjType(obj_history_save, save)->usage_background_ground_tex_normal = true;
		}
		
		return save;
	}
	
	IntType history_save_temp(ScopeAny self, VarType temp)
	{
		IntType save = (new obj_history_save)->id;
		ObjType(obj_history_save, save)->hobj = self->id;
		withOne (Object, temp, self->id)
			temp_copy(self, save);
		
		withOne (obj_history_save, save, self->id)
		{
			self->save_id = idVar(temp, save_id);
			temp_get_save_ids(self);
			if (self->type == e_temp_type_PARTICLE_SPAWNER)
			{
				self->pc_type_amount = ds_list_size(idInt(temp, pc_type_list));
				for (IntType p = IntType(0); p < self->pc_type_amount; p++)
					withOne (obj_history, self.otherId, self->id)
						ObjType(obj_history_save, save)->pc_type_save_obj[p] = history_save_ptype(ScopeAny(self), DsList(idInt(temp, pc_type_list)).Value(p));
				
			}
			self->usage_ptype_temp_amount = IntType(0);
			withAll (obj_particle_type, self->id)
			{
				if (ObjType(obj_particle_type, self->id)->temp != temp)
					continue;
				ObjType(obj_history_save, save)->usage_ptype_temp_save_id[ObjType(obj_history_save, save)->usage_ptype_temp_amount] = self->save_id;
				ObjType(obj_history_save, save)->usage_ptype_temp_amount++;
			}
			
		}
		
		ObjType(obj_history_save, save)->usage_tl_amount = IntType(0);
		history_save_temp_usage_tl(self, temp, save, global::_app->id);
		return save;
	}
	
	void history_save_temp_usage_tl(ScopeAny self, VarType temp, IntType save, VarType treeobj)
	{
		for (IntType t = IntType(0); t < ds_list_size(idInt(treeobj, tree_list)); t++)
		{
			VarType tl = DsList(idInt(treeobj, tree_list)).Value(t);
			if (ObjType(obj_timeline, tl)->temp == temp)
			{
				ObjType(obj_history_save, save)->usage_tl_save_obj[ObjType(obj_history_save, save)->usage_tl_amount] = history_save_tl(self, tl);
				ObjType(obj_history_save, save)->usage_tl_amount++;
			}
			else
				history_save_temp_usage_tl(self, temp, save, tl);
			
		}
	}
	
	IntType history_save_tl(ScopeAny self, VarType tl)
	{
		IntType save = (new obj_history_save)->id;
		ObjType(obj_history_save, save)->hobj = self->id;
		withOne (Object, tl, self->id)
			tl_copy(self, save);
		
		withOne (obj_history_save, save, self->id)
		{
			self->save_id = idVar(tl, save_id);
			tl_get_save_ids(self);
			for (IntType v = IntType(0); v < e_value_amount; v++)
				self->value_default[v] = tl_value_get_save_id(v, idArr(tl, value_default).Value(v));
			self->kf_amount = ds_list_size(idInt(tl, keyframe_list));
			for (IntType k = IntType(0); k < self->kf_amount; k++)
			{
				withOne (obj_keyframe, DsList(idInt(tl, keyframe_list)).Value(k), self->id)
				{
					ObjType(obj_history_save, save)->kf_pos[k] = self->position;
					for (IntType v = IntType(0); v < e_value_amount; v++)
						ObjType(obj_history_save, save)->kf_value[k][v] = tl_value_get_save_id(v, self->value.Value(v));
				}
				
			}
			self->usage_temp_shape_tex_amount = IntType(0);
			self->usage_temp_path_amount = IntType(0);
			withAll (obj_template, self->id)
			{
				if (self->shape_tex == tl)
				{
					ObjType(obj_history_save, save)->usage_temp_shape_tex_save_id[ObjType(obj_history_save, save)->usage_temp_shape_tex_amount] = self->save_id;
					ObjType(obj_history_save, save)->usage_temp_shape_tex_amount++;
				}
				if (self->type == e_temp_type_PARTICLE_SPAWNER && self->pc_spawn_region_path == tl)
				{
					ObjType(obj_history_save, save)->usage_temp_path_save_id[ObjType(obj_history_save, save)->usage_temp_path_amount] = self->save_id;
					ObjType(obj_history_save, save)->usage_temp_path_amount++;
				}
			}
			
			self->usage_tl_texture_amount = IntType(0);
			self->usage_tl_path_amount = IntType(0);
			self->usage_tl_attractor_amount = IntType(0);
			self->usage_tl_ik_target_amount = IntType(0);
			self->usage_tl_ik_target_angle_amount = IntType(0);
			withAll (obj_timeline, self->id)
			{
				if (self->value.Value(e_value_TEXTURE_OBJ) == tl)
				{
					ObjType(obj_history_save, save)->usage_tl_texture_save_id[ObjType(obj_history_save, save)->usage_tl_texture_amount] = self->save_id;
					ObjType(obj_history_save, save)->usage_tl_texture_amount++;
				}
				if (self->value.Value(e_value_PATH_OBJ) == tl)
				{
					ObjType(obj_history_save, save)->usage_tl_path_save_id[ObjType(obj_history_save, save)->usage_tl_path_amount] = self->save_id;
					ObjType(obj_history_save, save)->usage_tl_path_amount++;
				}
				if (self->value.Value(e_value_ATTRACTOR) == tl)
				{
					ObjType(obj_history_save, save)->usage_tl_attractor_save_id[ObjType(obj_history_save, save)->usage_tl_attractor_amount] = self->save_id;
					ObjType(obj_history_save, save)->usage_tl_attractor_amount++;
				}
				if (self->value.Value(e_value_IK_TARGET) == tl)
				{
					ObjType(obj_history_save, save)->usage_tl_ik_target_save_id[ObjType(obj_history_save, save)->usage_tl_ik_target_amount] = self->save_id;
					ObjType(obj_history_save, save)->usage_tl_ik_target_amount++;
				}
				if (self->value.Value(e_value_IK_TARGET_ANGLE) == tl)
				{
					ObjType(obj_history_save, save)->usage_tl_ik_target_angle_save_id[ObjType(obj_history_save, save)->usage_tl_ik_target_angle_amount] = self->save_id;
					ObjType(obj_history_save, save)->usage_tl_ik_target_angle_amount++;
				}
			}
			
			self->usage_kf_texture_amount = IntType(0);
			self->usage_kf_path_amount = IntType(0);
			self->usage_kf_ik_target_amount = IntType(0);
			self->usage_kf_ik_target_angle_amount = IntType(0);
			self->usage_kf_attractor_amount = IntType(0);
			withAll (obj_keyframe, self->id)
			{
				if (self->value.Value(e_value_TEXTURE_OBJ) == tl)
				{
					ObjType(obj_history_save, save)->usage_kf_texture_tl_save_id[ObjType(obj_history_save, save)->usage_kf_texture_amount] = save_id_get(self->timeline);
					ObjType(obj_history_save, save)->usage_kf_texture_index[ObjType(obj_history_save, save)->usage_kf_texture_amount] = ds_list_find_index(idInt(self->timeline, keyframe_list), self->id);
					ObjType(obj_history_save, save)->usage_kf_texture_amount++;
				}
				if (self->value.Value(e_value_PATH_OBJ) == tl)
				{
					ObjType(obj_history_save, save)->usage_kf_path_tl_save_id[ObjType(obj_history_save, save)->usage_kf_path_amount] = save_id_get(self->timeline);
					ObjType(obj_history_save, save)->usage_kf_path_index[ObjType(obj_history_save, save)->usage_kf_path_amount] = ds_list_find_index(idInt(self->timeline, keyframe_list), self->id);
					ObjType(obj_history_save, save)->usage_kf_path_amount++;
				}
				if (self->value.Value(e_value_IK_TARGET) == tl)
				{
					ObjType(obj_history_save, save)->usage_kf_ik_target_tl_save_id[ObjType(obj_history_save, save)->usage_kf_ik_target_amount] = save_id_get(self->timeline);
					ObjType(obj_history_save, save)->usage_kf_ik_target_index[ObjType(obj_history_save, save)->usage_kf_ik_target_amount] = ds_list_find_index(idInt(self->timeline, keyframe_list), self->id);
					ObjType(obj_history_save, save)->usage_kf_ik_target_amount++;
				}
				if (self->value.Value(e_value_IK_TARGET_ANGLE) == tl)
				{
					ObjType(obj_history_save, save)->usage_kf_ik_target_angle_tl_save_id[ObjType(obj_history_save, save)->usage_kf_ik_target_angle_amount] = save_id_get(self->timeline);
					ObjType(obj_history_save, save)->usage_kf_ik_target_angle_index[ObjType(obj_history_save, save)->usage_kf_ik_target_angle_amount] = ds_list_find_index(idInt(self->timeline, keyframe_list), self->id);
					ObjType(obj_history_save, save)->usage_kf_ik_target_angle_amount++;
				}
				if (self->value.Value(e_value_ATTRACTOR) == tl)
				{
					ObjType(obj_history_save, save)->usage_kf_attractor_tl_save_id[ObjType(obj_history_save, save)->usage_kf_attractor_amount] = save_id_get(self->timeline);
					ObjType(obj_history_save, save)->usage_kf_attractor_index[ObjType(obj_history_save, save)->usage_kf_attractor_amount] = ds_list_find_index(idInt(self->timeline, keyframe_list), self->id);
					ObjType(obj_history_save, save)->usage_kf_attractor_amount++;
				}
			}
			
			self->pattern_type = /*""*/ STR(0);
			if (idVar(tl, pattern_type) != /*""*/ STR(0) && idVar(tl, pattern_base_color) != null_)
			{
				self->pattern_type = idVar(tl, pattern_type);
				self->pattern_base_color = idVar(tl, pattern_base_color);
				self->pattern_pattern_list = array_copy_1d(idVar(tl, pattern_pattern_list));
				self->pattern_color_list = array_copy_1d(idVar(tl, pattern_color_list));
			}
			self->tree_amount = ds_list_size(idInt(tl, tree_list));
			for (IntType t = IntType(0); t < self->tree_amount; t++)
				self->tree_save_obj[t] = history_save_tl(ScopeAny(self), DsList(idInt(tl, tree_list)).Value(t));
			if (idInt(tl, part_list) != null_)
			{
				self->part_amount = ds_list_size(idInt(tl, part_list));
				for (IntType p = IntType(0); p < self->part_amount; p++)
					self->part_save_id[p] = save_id_get(DsList(idInt(tl, part_list)).Value(p));
			}
			else
				self->part_amount = IntType(0);
			
		}
		
		return save;
	}
	
}
