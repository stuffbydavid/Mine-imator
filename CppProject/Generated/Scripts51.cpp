/*
	NOTE:
	This file was autogenerated by CppGen, changes may be overwritten and forever lost!
	Modify at your own risk!
	
	[ Generated on 2023.08.26 14:40:22 ]
*/

#include "Scripts.hpp"

namespace CppProject
{
	RealType render_world_block_map(IntType modelmap, VarType res)
	{
		VarType key;
		if (modelmap == null_)
			return IntType(0);
		key = ds_map_find_first(modelmap);
		while (!is_undefined(key))
		{
			VarType vbuffer = DsMap(modelmap).Value(key);
			if (!vbuffer_is_empty(vbuffer))
			{
				VarType tex;
				withOne (Object, res, noone)
					tex = res_get_model_texture(self, key);
				
				render_set_texture(tex);
				vbuffer_render({ vbuffer });
			}
			key = ds_map_find_next(modelmap, key);
		}
		
		return 0.0;
	}
	
	void render_world_done()
	{
		gpu_set_ztestenable(false);
	}
	
	RealType render_world_ground(ScopeAny self)
	{
		if (!(sVar(background_ground_show) > 0))
			return IntType(0);
		if (global::render_mode == e_render_mode_SCENE_TEST || global::render_mode == e_render_mode_AO_MASK)
			render_set_uniform_color(/*"uReplaceColor"*/ STR(2537), c_white, IntType(1));
		VarType blend = block_texture_get_blend(sVar(background_ground_name), sVar(background_ground_tex));
		BoolType iswater = (sVar(background_ground_name) == /*"block/water_flow"*/ STR(1733) || sVar(background_ground_name) == /*"block/water_still"*/ STR(1731));
		render_set_uniform_int(/*"uIsGround"*/ STR(2538), IntType(1));
		render_set_uniform_color(/*"uBlendColor"*/ STR(1916), blend, IntType(1));
		render_set_uniform_color(/*"uGlowColor"*/ STR(2539), c_black, IntType(1));
		render_set_uniform_int(/*"uGlowTexture"*/ STR(2540), IntType(0));
		render_set_uniform_int(/*"uFogShow"*/ STR(1925), global::_app->background_fog_show);
		render_set_uniform_int(/*"uIsWater"*/ STR(2536), iswater);
		render_set_uniform_int(/*"uMaterialFormat"*/ STR(2530), idVar(sVar(background_ground_tex_material), material_format));
		if (sVar(background_ground_tex_material) == global::mc_res)
		{
			render_set_uniform(/*"uMetallic"*/ STR(2533), IntType(0));
			render_set_uniform(/*"uRoughness"*/ STR(2534), (iswater && global::_app->project_render_water_reflections > 0 ? .07 : 1.0));
			render_set_uniform(/*"uEmissive"*/ STR(2535), IntType(0));
		}
		else
		{
			render_set_uniform(/*"uMetallic"*/ STR(2533), IntType(0));
			render_set_uniform(/*"uRoughness"*/ STR(2534), IntType(0));
			render_set_uniform(/*"uEmissive"*/ STR(2535), IntType(0));
		}
		
		global::shader_texture_filter_mipmap = global::_app->project_render_texture_filtering;
		if (sBool(background_ground_ani))
			render_set_texture(sArr(background_ground_ani_texture).Value(block_texture_get_frame()));
		else
			render_set_texture(sInt(background_ground_texture));
		
		if (sBool(background_ground_material_ani))
			render_set_texture(sArr(background_ground_ani_texture_material).Value(block_texture_get_frame()), /*"Material"*/ STR(2531));
		else
			render_set_texture(sInt(background_ground_texture_material), /*"Material"*/ STR(2531));
		
		if (sBool(background_ground_normal_ani))
			render_set_texture(sArr(background_ground_ani_texture_normal).Value(block_texture_get_frame()), /*"Normal"*/ STR(2532));
		else
			render_set_texture(sInt(background_ground_texture_normal), /*"Normal"*/ STR(2532));
		
		RealType xo, yo;
		xo = ((IntType)(global::cam_from.Real(X_) / IntType(16))) * IntType(16);
		yo = ((IntType)(global::cam_from.Real(Y_) / IntType(16))) * IntType(16);
		vbuffer_render({ sVar(background_ground_vbuffer), point3D(xo, yo, IntType(0)) });
		render_set_uniform_int(/*"uIsGround"*/ STR(2538), IntType(0));
		if (iswater)
		{
			render_set_uniform(/*"uRoughness"*/ STR(2534), IntType(1));
			render_set_uniform_int(/*"uIsWater"*/ STR(2536), IntType(0));
		}
		global::shader_texture_filter_mipmap = false;
		return 0.0;
	}
	
	void render_world_item(VarType vbuffer, VarType is3d, VarType facecamera, VarType bounce, VarType rotate, ArrType res)
	{
		if (!res_is_ready(res.Value(IntType(0))))
			res[IntType(0)] = global::mc_res;
		if (!res_is_ready(res.Value(IntType(1))))
			res[IntType(1)] = global::mc_res;
		if (!res_is_ready(res.Value(IntType(2))))
			res[IntType(2)] = global::mc_res;
		if (facecamera > 0)
		{
			MatrixType mat, rotmat;
			RealType rotz;
			mat = matrix_get(matrix_world);
			rotz = IntType(90) + point_direction(mat.Real(MAT_X), mat.Real(MAT_Y), global::proj_from.Real(X_), global::proj_from.Real(Y_));
			rotmat = matrix_build(-8.0, -0.5 * is3d, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0);
			rotmat = matrix_multiply(rotmat, matrix_build(8.0, 0.5 * is3d, 0.0, 0.0, 0.0, rotz, 1.0, 1.0, 1.0));
			matrix_world_multiply_pre(rotmat);
		}
		if (rotate > 0)
		{
			RealType d, t, offz;
			MatrixType mat, rotmat;
			VarType rotz;
			d = IntType(60) * IntType(6);
			t = mod(global::_app->background_time, d) * IntType(360);
			offz = t / 360.0;
			mat = matrix_get(matrix_world);
			rotmat = matrix_build(-8.0, -0.5 * is3d, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0);
			rotmat = matrix_multiply(rotmat, matrix_build(8.0, 0.5 * is3d, 0.0, 0.0, 0.0, offz, 1.0, 1.0, 1.0));
			matrix_world_multiply_pre(rotmat);
		}
		if (bounce > 0)
		{
			RealType d, t, offz;
			d = IntType(60) * IntType(3);
			t = mod(global::_app->background_time, d) * IntType(2);
			if (t < d)
				offz = ease(/*"easeinoutquad"*/ STR(552), t / d) * IntType(2) - IntType(1);
			else
				offz = IntType(1) - ease(/*"easeinoutquad"*/ STR(552), (t - d) / d) * IntType(2);
			
			matrix_world_multiply_post(matrix_build(0.0, 0.0, offz, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0));
		}
		if (idInt(res.Value(IntType(0)), item_sheet_texture) != null_)
			render_set_texture(idInt(res.Value(IntType(0)), item_sheet_texture));
		else
			render_set_texture(idVar(res.Value(IntType(0)), texture));
		
		if (res.Value(IntType(1)) != null_ && res.Value(IntType(1)) != global::mc_res)
		{
			if (global::shader_uniform_metallic != IntType(0))
			{
				global::shader_uniform_metallic = IntType(0);
				render_set_uniform(/*"uMetallic"*/ STR(2533), global::shader_uniform_metallic);
			}
			if (global::shader_uniform_roughness != IntType(0))
			{
				global::shader_uniform_roughness = IntType(0);
				render_set_uniform(/*"uRoughness"*/ STR(2534), global::shader_uniform_roughness);
			}
			if (global::shader_uniform_emissive != IntType(0))
			{
				global::shader_uniform_emissive = IntType(0);
				render_set_uniform(/*"uEmissive"*/ STR(2535), global::shader_uniform_emissive);
			}
			if (idInt(res.Value(IntType(1)), item_sheet_texture_material) != null_)
				render_set_texture(idInt(res.Value(IntType(1)), item_sheet_texture_material), /*"Material"*/ STR(2531));
			else
				render_set_texture(idVar(res.Value(IntType(1)), texture), /*"Material"*/ STR(2531));
			
			render_set_uniform_int(/*"uMaterialFormat"*/ STR(2530), idVar(res.Value(IntType(1)), material_format));
		}
		else
		{
			render_set_texture(ID_spr_default_material, /*"Material"*/ STR(2531));
			render_set_uniform_int(/*"uMaterialFormat"*/ STR(2530), e_material_FORMAT_NONE);
		}
		
		if (res.Value(IntType(2)) != null_ && res.Value(IntType(2)) != global::mc_res)
		{
			if (idInt(res.Value(IntType(2)), item_sheet_tex_normal) != null_)
				render_set_texture(idInt(res.Value(IntType(2)), item_sheet_tex_normal), /*"Normal"*/ STR(2532));
			else
				render_set_texture(idVar(res.Value(IntType(2)), texture), /*"Normal"*/ STR(2532));
			
		}
		else
			render_set_texture(ID_spr_default_normal, /*"Normal"*/ STR(2532));
		
		vbuffer_render({ vbuffer });
	}
	
	void render_world_model_file_parts(ScopeAny self, VarType modelfile, VarType res, IntType texnamemap, IntType hidelist, IntType shapevbuffermap, IntType colornamemap, IntType shapehidelist, IntType shapetexnamemap, IntType matrixmap)
	{
		IntType partlist;
		MatrixType mat;
		partlist = idInt(modelfile, part_list);
		if (matrixmap != null_)
			partlist = idInt(modelfile, render_part_list);
		mat = matrix_get(matrix_world);
		for (IntType p = IntType(0); p < ds_list_size(partlist); p++)
		{
			VarType part = DsList(partlist).Value(p);
			if (matrixmap != null_)
			{
				if (ds_map_exists(matrixmap, idVar(part, name)))
					matrix_set(matrix_world, DsMap(matrixmap).Value(idVar(part, name)));
				else
					continue;
				
			}
			else
			{
				if (hidelist != null_ && ds_list_find_index(hidelist, idVar(part, name)) > -IntType(1))
					continue;
				matrix_set(matrix_world, matrix_multiply(idMat(part, default_matrix), mat));
			}
			
			if (idBool(part, part_mixing_shapes))
				render_set_uniform_int(/*"uColorsExt"*/ STR(2082), idBool(part, part_mixing_shapes));
			render_world_model_part(self, part, res, texnamemap, shapevbuffermap, colornamemap, shapehidelist, shapetexnamemap, null_);
			if (idBool(part, part_mixing_shapes))
				render_set_uniform_int(/*"uColorsExt"*/ STR(2082), IntType(0));
			if (matrixmap == null_)
			{
				if (idInt(part, part_list) != null_ && ds_list_size(idInt(part, part_list)) > IntType(0))
					render_world_model_file_parts(self, part, res, texnamemap, hidelist, shapevbuffermap, colornamemap, shapehidelist, shapetexnamemap);
			}
		}
		matrix_set(matrix_world, mat);
	}
	
	RealType render_world_model_part(ScopeAny self, VarType part, VarType res, IntType texnamemap, IntType shapevbuffermap, IntType colornamemap, IntType shapehidelist, IntType shapetexnamemap, VarType tlobject)
	{
		if (idInt(part, shape_list) == null_)
			return IntType(0);
		StringType parttexname;
		MatrixType mat;
		parttexname = ((tlobject > 0) ? /*""*/ STR(0) : string(model_part_get_texture_name(part, texnamemap)));
		if (!(tlobject > 0))
			mat = matrix_get(matrix_world);
		VarType shape, texobj, blendcolor, alpha;
		texobj = null_;
		blendcolor = null_;
		alpha = null_;
		global::render_blend_prev = null_;
		global::render_alpha_prev = null_;
		for (IntType s = IntType(0); s < ds_list_size(idInt(part, shape_list)); s++)
		{
			shape = DsList(idInt(part, shape_list)).Value(s);
			if (shapehidelist != null_ && ds_list_find_index(shapehidelist, ObjType(obj_model_shape, shape)->description) > -IntType(1))
				continue;
			if (global::render_mode == e_render_mode_CLICK && ObjType(obj_model_shape, shape)->locked > 0)
				continue;
			if ((ObjType(obj_model_shape, shape)->color_alpha * IntType(1000)) == IntType(0))
				continue;
			if (ObjType(obj_model_shape, shape)->move_required)
			{
				if (!(tlobject > 0))
					continue;
				if (!(abs(idVar(tlobject, value).Value(e_value_POS_X)) > ObjType(obj_model_shape, shape)->move_required_array.Value(X_) && abs(idVar(tlobject, value).Value(e_value_POS_Y)) > ObjType(obj_model_shape, shape)->move_required_array.Value(Y_) && abs(idVar(tlobject, value).Value(e_value_POS_Z)) > ObjType(obj_model_shape, shape)->move_required_array.Value(Z_)))
					continue;
			}
			if (tlobject > 0)
			{
				if (s > array_length(VarType::CreateRef(sArr(model_part_shape_tex))) - IntType(1))
					continue;
				render_set_texture(sArr(model_part_shape_tex).Value(s));
				render_set_uniform_int(/*"uMaterialFormat"*/ STR(2530), sArr(model_part_shape_material_res).Value(s));
				if (sArr(model_part_shape_tex_material).Value(s) == null_)
				{
					render_set_texture(ID_spr_default_material, /*"Material"*/ STR(2531));
					if (sArr(value_inherit).Value(e_value_EMISSIVE) != global::shader_uniform_emissive)
					{
						global::shader_uniform_emissive = sArr(value_inherit).Value(e_value_EMISSIVE);
						render_set_uniform(/*"uEmissive"*/ STR(2535), global::shader_uniform_emissive);
					}
					if (sArr(value_inherit).Value(e_value_METALLIC) != global::shader_uniform_metallic)
					{
						global::shader_uniform_metallic = sArr(value_inherit).Value(e_value_METALLIC);
						render_set_uniform(/*"uMetallic"*/ STR(2533), global::shader_uniform_metallic);
					}
					if (sArr(value_inherit).Value(e_value_ROUGHNESS) != global::shader_uniform_roughness)
					{
						global::shader_uniform_roughness = sArr(value_inherit).Value(e_value_ROUGHNESS);
						render_set_uniform(/*"uRoughness"*/ STR(2534), global::shader_uniform_roughness);
					}
				}
				else
				{
					render_set_texture(sArr(model_part_shape_tex_material).Value(s), /*"Material"*/ STR(2531));
					if (global::shader_uniform_metallic != IntType(1))
					{
						global::shader_uniform_metallic = IntType(0);
						render_set_uniform(/*"uMetallic"*/ STR(2533), global::shader_uniform_metallic);
					}
					if (global::shader_uniform_roughness != IntType(0))
					{
						global::shader_uniform_roughness = IntType(0);
						render_set_uniform(/*"uRoughness"*/ STR(2534), global::shader_uniform_roughness);
					}
					if (global::shader_uniform_emissive != IntType(1))
					{
						global::shader_uniform_emissive = IntType(0);
						render_set_uniform(/*"uEmissive"*/ STR(2535), global::shader_uniform_emissive);
					}
				}
				
				if (sArr(model_part_shape_tex_normal).Value(s) == null_)
					render_set_texture(ID_spr_default_normal, /*"Normal"*/ STR(2532));
				else
					render_set_texture(sArr(model_part_shape_tex_normal).Value(s), /*"Normal"*/ STR(2532));
				
			}
			else
			{
				VarType shapetexname = parttexname;
				if (ObjType(obj_model_shape, shape)->texture_name != /*""*/ STR(0))
					shapetexname = ObjType(obj_model_shape, shape)->texture_name;
				if (shapetexnamemap != null_)
				{
					VarType maptexname = DsMap(shapetexnamemap).Value(ObjType(obj_model_shape, shape)->description);
					if (!is_undefined(maptexname))
						shapetexname = maptexname;
				}
				withOne (Object, res, self->id)
				{
					texobj = res_get_model_texture(self, shapetexname);
					render_set_texture(texobj);
				}
				
			}
			
			if (self->subAssetId == ID_obj_preview && idVar(sVar(select), pattern_type) != /*""*/ STR(0))
			{
				if (sprite_exists(idInt(sVar(select), pattern_skin)))
					render_set_texture(idInt(sVar(select), pattern_skin));
			}
			if (tlobject != null_)
			{
				if (sprite_exists(idInt(tlobject, pattern_skin)))
				{
					VarType tempres = null_;
					withOne (Object, idVar(tlobject, temp), self->id)
						tempres = temp_get_model_texobj(self, null_);
					
					if (res == tempres)
						if (sprite_exists(idInt(tlobject, pattern_skin)))
							render_set_texture(idInt(tlobject, pattern_skin));
				}
				else
					if (idVar(idVar(tlobject, temp), pattern_type) != /*""*/ STR(0))
					{
						VarType tempres = null_;
						withOne (Object, idVar(tlobject, temp), self->id)
							tempres = temp_get_model_texobj(self, null_);
						
						if (res == tempres)
							if (sprite_exists(idInt(idVar(tlobject, temp), pattern_skin)))
								render_set_texture(idInt(idVar(tlobject, temp), pattern_skin));
					}
				
			}
			if (self->subAssetId == ID_obj_preview && idVar(sVar(select), model_name) == /*"armor"*/ STR(751))
			{
				if (ObjType(obj_model_shape, shape)->description == /*"helmet"*/ STR(1996))
				{
					if (sprite_exists(idArr(sVar(select), armor_skin_array).Value(IntType(0))))
						render_set_texture(idArr(sVar(select), armor_skin_array).Value(IntType(0)));
				}
				if (ObjType(obj_model_shape, shape)->description == /*"chestplate"*/ STR(1997))
				{
					if (sprite_exists(idArr(sVar(select), armor_skin_array).Value(IntType(1))))
						render_set_texture(idArr(sVar(select), armor_skin_array).Value(IntType(1)));
				}
				if (ObjType(obj_model_shape, shape)->description == /*"leggings"*/ STR(1998))
				{
					if (sprite_exists(idArr(sVar(select), armor_skin_array).Value(IntType(2))))
						render_set_texture(idArr(sVar(select), armor_skin_array).Value(IntType(2)));
				}
				if (ObjType(obj_model_shape, shape)->description == /*"boots"*/ STR(1999))
				{
					if (sprite_exists(idArr(sVar(select), armor_skin_array).Value(IntType(3))))
						render_set_texture(idArr(sVar(select), armor_skin_array).Value(IntType(3)));
				}
			}
			if (tlobject != null_ && idVar(idVar(tlobject, temp), model_name) == /*"armor"*/ STR(751))
			{
				if (ObjType(obj_model_shape, shape)->description == /*"helmet"*/ STR(1996))
				{
					if (sprite_exists(idArr(idVar(tlobject, temp), armor_skin_array).Value(IntType(0))))
						render_set_texture(idArr(idVar(tlobject, temp), armor_skin_array).Value(IntType(0)));
				}
				if (ObjType(obj_model_shape, shape)->description == /*"chestplate"*/ STR(1997))
				{
					if (sprite_exists(idArr(idVar(tlobject, temp), armor_skin_array).Value(IntType(1))))
						render_set_texture(idArr(idVar(tlobject, temp), armor_skin_array).Value(IntType(1)));
				}
				if (ObjType(obj_model_shape, shape)->description == /*"leggings"*/ STR(1998))
				{
					if (sprite_exists(idArr(idVar(tlobject, temp), armor_skin_array).Value(IntType(2))))
						render_set_texture(idArr(idVar(tlobject, temp), armor_skin_array).Value(IntType(2)));
				}
				if (ObjType(obj_model_shape, shape)->description == /*"boots"*/ STR(1999))
				{
					if (sprite_exists(idArr(idVar(tlobject, temp), armor_skin_array).Value(IntType(3))))
						render_set_texture(idArr(idVar(tlobject, temp), armor_skin_array).Value(IntType(3)));
				}
			}
			blendcolor = ObjType(obj_model_shape, shape)->color_blend;
			alpha = ObjType(obj_model_shape, shape)->color_alpha;
			if (colornamemap != null_)
			{
				VarType color = DsMap(colornamemap).Value(ObjType(obj_model_shape, shape)->description);
				if (!is_undefined(color))
					blendcolor = color;
			}
			if (ObjType(obj_model_shape, shape)->use_model_color > 0)
			{
				if (self->subAssetId == ID_obj_preview && idVar(sVar(select), model_use_blend_color) > 0)
					blendcolor = color_multiply(blendcolor, idVar(sVar(select), model_blend_color));
				if (tlobject != null_ && idVar(idVar(tlobject, temp), model_use_blend_color) > 0)
					blendcolor = color_multiply(blendcolor, idVar(idVar(tlobject, temp), model_blend_color));
			}
			if (blendcolor != c_white || alpha != IntType(1))
			{
				blendcolor = color_multiply(global::shader_blend_color, blendcolor);
				alpha = global::shader_blend_alpha * ObjType(obj_model_shape, shape)->color_alpha;
			}
			else
			{
				blendcolor = global::shader_blend_color;
				alpha = global::shader_blend_alpha;
			}
			
			if (blendcolor != global::render_blend_prev || alpha != global::render_alpha_prev)
			{
				render_set_uniform_color(/*"uBlendColor"*/ STR(1916), blendcolor, alpha);
				global::render_blend_prev = blendcolor;
				global::render_alpha_prev = alpha;
			}
			if (ObjType(obj_model_shape, shape)->color_mix_percent > IntType(0))
			{
				if (tlobject != null_)
					render_set_uniform_color(/*"uMixColor"*/ STR(2088), merge_color((IntType)(ObjType(obj_model_shape, shape)->color_mix), (IntType)(sArr(value_inherit).Value(e_value_MIX_COLOR)), sArr(value_inherit).Value(e_value_MIX_PERCENT)), lerp(ObjType(obj_model_shape, shape)->color_mix_percent, sArr(value_inherit).Value(e_value_MIX_PERCENT), sArr(value_inherit).Value(e_value_MIX_PERCENT)));
				else
					render_set_uniform_color(/*"uMixColor"*/ STR(2088), ObjType(obj_model_shape, shape)->color_mix, ObjType(obj_model_shape, shape)->color_mix_percent);
				
			}
			MatrixType rendermatrix;
			if (tlobject > 0)
				rendermatrix = matrix_multiply(ObjType(obj_model_shape, shape)->matrix, sMat(matrix_render));
			else
				rendermatrix = matrix_multiply(ObjType(obj_model_shape, shape)->matrix, mat);
			
			if (ObjType(obj_model_shape, shape)->item_bounce > 0)
			{
				RealType d, t, offz;
				d = IntType(60) * IntType(3);
				t = mod(global::_app->background_time, d) * IntType(2);
				if (t < d)
					offz = ease(/*"easeinoutquad"*/ STR(552), t / d) * IntType(2) - IntType(1);
				else
					offz = IntType(1) - ease(/*"easeinoutquad"*/ STR(552), (t - d) / d) * IntType(2);
				
				rendermatrix = matrix_multiply(rendermatrix, matrix_build(0.0, 0.0, offz, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0));
			}
			if (ObjType(obj_model_shape, shape)->face_camera > 0)
			{
				RealType rotx, rotz;
				MatrixType rotmat;
				matrix_remove_rotation(VarType::CreateRef(rendermatrix));
				rotx = -point_zdirection(rendermatrix.Real(MAT_X), rendermatrix.Real(MAT_Y), rendermatrix.Real(MAT_Z), global::proj_from.Real(X_), global::proj_from.Real(Y_), global::proj_from.Real(Z_));
				rotz = IntType(90) + point_direction(rendermatrix.Real(MAT_X), rendermatrix.Real(MAT_Y), global::proj_from.Real(X_), global::proj_from.Real(Y_));
				rotmat = matrix_build(0.0, 0.0, 0.0, rotx, 0.0, rotz, 1.0, 1.0, 1.0);
				rendermatrix = matrix_multiply(rotmat, rendermatrix);
			}
			if (shapevbuffermap != null_ && !is_undefined(DsMap(shapevbuffermap).Value(shape)))
				vbuffer_render_matrix(DsMap(shapevbuffermap).Value(shape), rendermatrix);
		}
		if (!(tlobject > 0))
			matrix_set(matrix_world, mat);
		return 0.0;
	}
	
	RealType render_world_particle(ScopeAny self)
	{
		VarType temp, prevcolor, prevalpha;
		temp = idVar(sVar(type), temp);
		prevcolor = global::shader_blend_color;
		prevalpha = global::shader_blend_alpha;
		global::shader_blend_color = color_multiply(prevcolor, sVar(color));
		global::shader_blend_alpha *= sVar(alpha);
		render_set_uniform_color(/*"uBlendColor"*/ STR(1916), global::shader_blend_color, global::shader_blend_alpha);
		if (temp != particle_sheet && temp != particle_template)
		{
			VarType scenery, rep;
			VecType off;
			off = point3D(IntType(0), IntType(0), IntType(0));
			if (idVar(temp, block_repeat_enable) > 0)
				rep = idVar(temp, block_repeat);
			else
				rep = vec3(IntType(1));
			
			switch ((IntType)idVar(temp, type))
			{
				case e_temp_type_MODEL:
				{
					if (idVar(temp, model) == null_)
						break;
					if (idInt(idVar(temp, model), model_format) == e_model_format_BLOCK)
					{
						off = point3D_mul(rep, -block_size_ / 2.0);
						break;
					}
				}
				
				case e_temp_type_CHARACTER:
				case e_temp_type_SPECIAL_BLOCK:
				{
					if (idVar(temp, model_file) != null_)
						off = point3D(IntType(0), IntType(0), -(idVec(idVar(temp, model_file), bounds_parts_end).Real(Z_) - idVec(idVar(temp, model_file), bounds_parts_start).Real(Z_)) / 2.0);
					break;
				}
				
				case e_temp_type_SCENERY:
				{
					scenery = idVar(temp, scenery);
					if (scenery == null_)
						break;
					VecType displaysize = vec3_mul(vec3_mul(idVec(scenery, scenery_size), rep), vec3(block_size_));
					off = vec3_mul(displaysize, vec3(-0.5));
					break;
				}
				
				case e_temp_type_BLOCK:
				{
					off = point3D_mul(rep, -block_size_ / 2.0);
					break;
				}
				
				case e_temp_type_ITEM:
				{
					off = point3D(-IntType(8), -0.5, IntType(0));
					break;
				}
				
			}
			
			matrix_set(matrix_world, matrix_multiply(matrix_create(off, vec3(IntType(0)), vec3(IntType(1))), matrix_create(sVar(pos), sVar(rot), vec3(sVar(scale)))));
			switch ((IntType)idVar(temp, type))
			{
				case e_temp_type_MODEL:
				{
					if (idVar(temp, model) == null_)
						break;
					if (idInt(idVar(temp, model), model_format) == e_model_format_BLOCK)
					{
						VarType res;
						if (idVar(temp, model_tex) != null_ && idInt(idVar(temp, model_tex), block_sheet_texture) != null_)
							res = idVar(temp, model_tex);
						else
							res = global::mc_res;
						
						render_world_block(idVar(idVar(temp, model), block_vbuffer), res);
						withOne (Object, temp, self->id)
							res = temp_get_model_texobj(self, null_);
						
						render_world_block_map(idInt(idVar(temp, model), model_block_map), res);
						break;
					}
				}
				
				case e_temp_type_CHARACTER:
				case e_temp_type_SPECIAL_BLOCK:
				{
					if (idVar(temp, model_file) == null_)
						break;
					VarType res;
					withOne (Object, temp, self->id)
						res = temp_get_model_texobj(self, null_);
					
					render_world_model_file_parts(self, idVar(temp, model_file), res, idInt(temp, model_texture_name_map), idInt(temp, model_hide_list), idInt(temp, model_shape_vbuffer_map), idInt(temp, model_color_map), idInt(temp, model_shape_hide_list), idInt(temp, model_shape_texture_name_map));
					break;
				}
				
				case e_temp_type_SCENERY:
				{
					if (scenery != null_)
						render_world_scenery(self, scenery, ArrType::From({ idVar(temp, block_tex), idVar(temp, block_tex_material), idVar(temp, block_tex_normal) }), idVar(temp, block_repeat_enable), idVar(temp, block_repeat));
					break;
				}
				
				case e_temp_type_ITEM:
				{
					render_world_item(idVar(temp, item_vbuffer), idVar(temp, item_3d), idVar(temp, item_face_camera), idVar(temp, item_bounce), idVar(temp, item_spin), ArrType::From({ idVar(temp, item_tex), null_, null_ }));
					break;
				}
				
				case e_temp_type_BLOCK:
				{
					render_world_block(idVar(temp, block_vbuffer), idVar(temp, block_tex), true, rep);
					break;
				}
				
				case e_temp_type_BODYPART:
				{
					if (idVar(temp, model_part) == null_ || idVar(temp, model_file) == null_)
						break;
					VarType res = idVar(temp, model_tex);
					if (!res_is_ready(res))
						res = global::mc_res;
					render_world_model_part(self, idVar(temp, model_part), res, idInt(temp, model_texture_name_map), idInt(temp, model_shape_vbuffer_map), idInt(temp, model_color_map), idInt(temp, model_shape_hide_list), idInt(temp, model_shape_texture_name_map), null_);
					break;
				}
				
				case e_temp_type_TEXT:
				{
					render_world_text(idVar(sVar(type), text_vbuffer), idVar(sVar(type), text_texture), idVar(temp, text_face_camera), idVar(temp, text_font), null_);
					break;
				}
				
				default:
				{
					VarType tex;
					withOne (Object, temp, self->id)
						tex = temp_get_shape_tex(temp_get_shape_texobj(self, null_));
					
					render_world_shape(idVar(temp, type), idVar(temp, shape_vbuffer), idVar(temp, shape_face_camera), ArrType::From({ tex, ID_spr_default_material, ID_spr_default_normal }));
					break;
				}
			}
			
		}
		else
		{
			if (idVar(sVar(type), temp) == particle_sheet)
			{
				VarType res = idVar(sVar(type), sprite_tex);
				if (!res_is_ready(res))
					res = global::mc_res;
				render_set_texture(idArr(res, particles_texture).Value(idVar(sVar(type), sprite_tex_image)));
			}
			else
			{
				IntType template_ = DsMap(global::particle_template_map).Value(idVar(sVar(type), sprite_template));
				VarType res = idVar(sVar(type), sprite_template_tex);
				if (!res_is_ready(res))
					res = global::mc_res;
				IntType tex = DsMap(idInt(res, particle_texture_atlas_map)).Value(ObjType(obj_particle_template, template_)->name);
				if (tex == VarType())
				{
					global::shader_blend_color = prevcolor;
					global::shader_blend_alpha = prevalpha;
					return IntType(0);
				}
				else
				{
					render_set_texture(tex);
					render_set_texture(ID_spr_default_material, /*"Material"*/ STR(2531));
					render_set_texture(ID_spr_default_normal, /*"Normal"*/ STR(2532));
					render_set_uniform_int(/*"uMaterialFormat"*/ STR(2530), e_material_FORMAT_NONE);
				}
				
			}
			
			RealType xyang, zang, m;
			xyang = IntType(90) + point_direction(sVar(pos).Value(X_), sVar(pos).Value(Y_), global::proj_from.Real(X_), global::proj_from.Real(Y_));
			zang = -point_zdirection(sVar(pos).Value(X_), sVar(pos).Value(Y_), sVar(pos).Value(Z_), global::proj_from.Real(X_), global::proj_from.Real(Y_), global::proj_from.Real(Z_));
			if (idVar(sVar(type), temp) == particle_sheet)
				m = mod(max({ IntType(0), sReal(frame) - min({ idVar(sVar(type), sprite_frame_start), idVar(sVar(type), sprite_frame_end) }) }), idVar(sVar(type), sprite_vbuffer_amount));
			else
				m = mod(max({ IntType(0), sReal(frame) }), idVar(sVar(type), sprite_vbuffer_amount));
			
			matrix_set(matrix_world, matrix_create(sVar(pos), vec3(zang, sVar(sprite_angle), xyang), vec3(sVar(scale))));
			vbuffer_render({ idArr(sVar(type), sprite_vbuffer).Value(m) });
		}
		
		global::shader_blend_color = prevcolor;
		global::shader_blend_alpha = prevalpha;
		return 0.0;
	}
	
	RealType render_world_scenery(ScopeAny self, VarType scenery, VarType res, VarType repeatenable, VarType rep)
	{
		if (!idBool(scenery, ready))
			return IntType(0);
		if (repeatenable > 0)
		{
			MatrixType mat;
			VecType reppos;
			ArrType defrot, defscale;
			mat = matrix_get(matrix_world);
			reppos = ArrType::From({ IntType(0), IntType(0), IntType(0) });
			defrot = ArrType::From({ IntType(0), IntType(0), IntType(0) });
			defscale = ArrType::From({ IntType(1), IntType(1), IntType(1) });
			for (reppos.Real(X_) = IntType(0); reppos.Real(X_) < rep.Value(X_); reppos.Real(X_)++)
			{
				for (reppos.Real(Y_) = IntType(0); reppos.Real(Y_) < rep.Value(Y_); reppos.Real(Y_)++)
				{
					for (reppos.Real(Z_) = IntType(0); reppos.Real(Z_) < rep.Value(Z_); reppos.Real(Z_)++)
					{
						VecType pos = vec3_mul(idVec(scenery, scenery_size), point3D_mul(reppos, block_size_));
						matrix_set(matrix_world, matrix_multiply(matrix_create(pos, defrot, defscale), mat));
						render_world_block(idVar(scenery, block_vbuffer), res, true, idVec(scenery, scenery_size));
						if (Obj(self->id)->subAssetId != ID_obj_preview)
						{
							if (sArr(value_inherit).Value(e_value_ROUGHNESS) != global::shader_uniform_roughness)
							{
								global::shader_uniform_roughness = sArr(value_inherit).Value(e_value_ROUGHNESS);
								render_set_uniform(/*"uRoughness"*/ STR(2534), global::shader_uniform_roughness);
							}
							if (sArr(value_inherit).Value(e_value_METALLIC) != global::shader_uniform_metallic)
							{
								global::shader_uniform_metallic = sArr(value_inherit).Value(e_value_METALLIC);
								render_set_uniform(/*"uMetallic"*/ STR(2533), global::shader_uniform_metallic);
							}
							if (sArr(value_inherit).Value(e_value_EMISSIVE) != global::shader_uniform_emissive)
							{
								global::shader_uniform_emissive = sArr(value_inherit).Value(e_value_EMISSIVE);
								render_set_uniform(/*"uEmissive"*/ STR(2535), global::shader_uniform_emissive);
							}
						}
					}
				}
			}
		}
		else
			render_world_block(idVar(scenery, block_vbuffer), res, true, idVec(scenery, scenery_size));
		
		return 0.0;
	}
	
	void render_world_shape(VarType type, VarType vbuf, VarType facecamera, ArrType tex)
	{
		if (type == e_temp_type_SURFACE && facecamera > 0)
		{
			MatrixType mat;
			RealType rotx, rotz;
			mat = matrix_get(matrix_world);
			rotx = -point_zdirection(mat.Real(MAT_X), mat.Real(MAT_Y), mat.Real(MAT_Z), global::proj_from.Real(X_), global::proj_from.Real(Y_), global::proj_from.Real(Z_));
			rotz = IntType(90) + point_direction(mat.Real(MAT_X), mat.Real(MAT_Y), global::proj_from.Real(X_), global::proj_from.Real(Y_));
			matrix_world_multiply_pre(matrix_build(0.0, 0.0, 0.0, rotx, 0.0, rotz, 1.0, 1.0, 1.0));
		}
		render_set_texture(tex.Value(IntType(0)));
		render_set_texture(tex.Value(IntType(1)), /*"Material"*/ STR(2531));
		render_set_texture(tex.Value(IntType(2)), /*"Normal"*/ STR(2532));
		vbuffer_render({ vbuf });
	}
	
	RealType render_world_sky()
	{
		if (!(global::render_background > 0))
			return IntType(0);
		VarType hashprev = global::render_alpha_hash;
		global::render_alpha_hash = false;
		render_set_uniform_int(/*"uAlphaHash"*/ STR(1933), global::render_alpha_hash);
		global::render_shader_obj = DsMap(global::shader_map).Value(ID_shader_blend);
		withOne (Object, global::render_shader_obj, global::_app->id)
			shader_use(self);
		
		RealType dis = global::_app->project_render_distance * 0.75;
		gpu_set_zwriteenable(false);
		if (global::_app->background_image_show > 0 && global::_app->background_image != null_ && global::_app->background_image_type != /*"image"*/ STR(94))
		{
			VarType vbuf;
			if (global::_app->background_image_type == /*"sphere"*/ STR(526))
			{
				if (!(global::_app->background_image_sphere_vbuffer > 0))
					global::_app->background_image_sphere_vbuffer = vbuffer_create_sphere(IntType(1), point2D(IntType(1), IntType(0)), point2D(IntType(0), IntType(1)), IntType(32), true);
				vbuf = global::_app->background_image_sphere_vbuffer;
			}
			else
				if (global::_app->background_image_type == /*"box"*/ STR(1325))
				{
					if (global::_app->background_image_box_mapped > 0)
					{
						if (!(global::_app->background_image_cube_mapped_vbuffer > 0))
							global::_app->background_image_cube_mapped_vbuffer = vbuffer_create_cube(IntType(1), point2D(IntType(0), IntType(0)), point2D(IntType(1), IntType(1)), -IntType(1), IntType(1), true, true);
						vbuf = global::_app->background_image_cube_mapped_vbuffer;
					}
					else
					{
						if (!(global::_app->background_image_cube_vbuffer > 0))
							global::_app->background_image_cube_vbuffer = vbuffer_create_cube(IntType(1), point2D(IntType(1), IntType(0)), point2D(IntType(0), IntType(1)), IntType(1), IntType(1), true, false);
						vbuf = global::_app->background_image_cube_vbuffer;
					}
					
				}
			
			render_set_uniform_color(/*"uBlendColor"*/ STR(1916), c_white, IntType(1));
			render_set_texture(idVar(global::_app->background_image, texture));
			vbuffer_render({ vbuf, global::cam_from, point3D(IntType(0), IntType(0), global::_app->background_image_rotation), vec3(dis) });
		}
		if (global::_app->background_fog_show > 0 && global::_app->background_fog_sky > 0)
		{
			if (global::_app->background_fog_vbuffer == null_)
				global::_app->background_fog_vbuffer = vbuffer_create_sphere(IntType(1), point2D(IntType(0), IntType(0)), point2D(IntType(1), IntType(1)), IntType(16), true);
			gpu_set_texrepeat(false);
			global::shader_texture_filter_linear = false;
			render_set_uniform_color(/*"uBlendColor"*/ STR(1916), global::_app->background_fog_color_final, IntType(1));
			render_set_texture(global::_app->background_fog_texture);
			vbuffer_render({ global::_app->background_fog_vbuffer, global::cam_from, vec3(IntType(0)), vec3(dis, dis, dis * (((RealType)global::_app->background_fog_height / 1000.0) + (((RealType)global::_app->background_fog_height / 1000.0) * max({ global::_app->background_sunrise_alpha, global::_app->background_sunset_alpha })))) });
			gpu_set_texrepeat(true);
		}
		if (!(global::_app->background_image_show > 0))
		{
			MatrixType skymat = matrix_build(global::cam_from.Real(X_), global::cam_from.Real(Y_), global::cam_from.Real(Z_), -global::_app->background_sky_time, 0.0, global::_app->background_sky_rotation, 1.0, 1.0, 1.0);
			RealType vis;
			if (global::_app->background_night_alpha > IntType(0))
			{
				if (global::_app->background_sky_stars_vbuffer == null_)
					global::_app->background_sky_stars_vbuffer = vbuffer_create_cube(0.8, point2D(IntType(0), IntType(0)), point2D(IntType(2), IntType(2)), false, false, true, false);
				render_set_uniform_color(/*"uBlendColor"*/ STR(1916), c_white, 0.4 * global::_app->background_night_alpha);
				render_set_texture(global::_app->background_sky_stars_texture);
				vbuffer_render_matrix(global::_app->background_sky_stars_vbuffer, matrix_multiply(matrix_build(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, dis, dis, dis), skymat));
			}
			gpu_set_blendmode(bm_add);
			vis = percent(vec3_dot(global::_app->background_sun_direction, vec3(IntType(0), IntType(0), IntType(1))), -0.15, IntType(0));
			if (global::_app->background_sky_sun_moon_vbuffer == null_)
				global::_app->background_sky_sun_moon_vbuffer = vbuffer_create_surface(IntType(1), point2D(IntType(0), IntType(0)), point2D(IntType(1), IntType(1)), false);
			render_set_uniform_color(/*"uBlendColor"*/ STR(1916), c_white, vis);
			if (idVar(global::_app->background_sky_sun_tex, type) == e_res_type_PACK)
				render_set_texture(idVar(global::_app->background_sky_sun_tex, sun_texture));
			else
				render_set_texture(idVar(global::_app->background_sky_sun_tex, texture));
			
			RealType sca = (dis / 15000.0) * IntType(1850);
			vbuffer_render_matrix(global::_app->background_sky_sun_moon_vbuffer, matrix_multiply(matrix_build(0.0, 0.0, min({ dis * 0.7, max({ IntType(0), (dis * 0.7) / global::_app->background_sky_sun_scale }) }), 90.0, 0.0, 0.0 + global::_app->background_sky_sun_angle, sca * min({ IntType(1), global::_app->background_sky_sun_scale }), sca * min({ IntType(1), global::_app->background_sky_sun_scale }), sca), skymat));
			vis = percent(vec3_dot(global::_app->background_sun_direction, vec3(IntType(0), IntType(0), -IntType(1))), -0.15, IntType(0));
			render_set_uniform_color(/*"uBlendColor"*/ STR(1916), c_white, vis);
			if (idVar(global::_app->background_sky_moon_tex, type) == e_res_type_PACK && idBool(global::_app->background_sky_moon_tex, ready))
			{
				VarType phase = global::_app->background_sky_moon_phase;
				render_set_texture(idArr(global::_app->background_sky_moon_tex, moon_texture).Value(phase));
			}
			else
				render_set_texture(idVar(global::_app->background_sky_moon_tex, texture));
			
			vbuffer_render_matrix(global::_app->background_sky_sun_moon_vbuffer, matrix_multiply(matrix_build(0.0, 0.0, max({ -dis * 0.7, min({ IntType(0), (-dis * 0.7) / global::_app->background_sky_moon_scale }) }), -90.0, 0.0, IntType(0) - global::_app->background_sky_moon_angle, sca * min({ IntType(1), global::_app->background_sky_moon_scale }), sca * min({ IntType(1), global::_app->background_sky_moon_scale }), sca), skymat));
			gpu_set_blendmode(bm_normal);
		}
		withOne (Object, global::render_shader_obj, global::_app->id)
			shader_clear();
		
		gpu_set_zwriteenable(true);
		global::render_alpha_hash = hashprev;
		render_set_uniform_int(/*"uAlphaHash"*/ STR(1933), global::render_alpha_hash);
		return 0.0;
	}
	
	RealType render_world_sky_clouds(ScopeAny self)
	{
		if (!(sVar(background_sky_clouds_show) > 0) || !(global::render_background > 0) || global::render_mode == e_render_mode_DEPTH_NO_SKY)
			return IntType(0);
		if (global::render_mode == e_render_mode_SCENE_TEST || global::render_mode == e_render_mode_AO_MASK)
			render_set_uniform_color(/*"uReplaceColor"*/ STR(2537), c_black, IntType(1));
		VarType res = sVar(background_sky_clouds_tex);
		if (!res_is_ready(res))
			res = global::mc_res;
		render_set_uniform_int(/*"uIsSky"*/ STR(2541), IntType(1));
		render_set_uniform_color(/*"uBlendColor"*/ STR(1916), sInt(background_sky_clouds_final), sReal(background_clouds_alpha));
		render_set_uniform_color(/*"uGlowColor"*/ STR(2539), c_black, IntType(1));
		render_set_uniform_int(/*"uGlowTexture"*/ STR(2540), IntType(0));
		render_set_uniform(/*"uMetallic"*/ STR(2533), IntType(0));
		render_set_uniform(/*"uRoughness"*/ STR(2534), IntType(1));
		render_set_uniform(/*"uEmissive"*/ STR(2535), IntType(0));
		render_set_uniform(/*"uLightSpecular"*/ STR(2542), IntType(0));
		if (idVar(res, type) == e_res_type_PACK)
			render_set_texture(idVar(res, clouds_texture));
		else
			render_set_texture(idVar(res, texture));
		
		render_set_texture(ID_spr_default_material, /*"Material"*/ STR(2531));
		render_set_texture(ID_spr_default_normal, /*"Normal"*/ STR(2532));
		if (!(sVar(background_fog_show) > 0) || !(sVar(background_fog_sky) > 0))
			render_set_uniform(/*"uFogShow"*/ STR(1925), IntType(0));
		for (IntType i = IntType(0); i < array_length(VarType::CreateRef(sArr(background_sky_clouds_vbuffer_pos))); i++)
			vbuffer_render({ sVar(background_sky_clouds_vbuffer), sArr(background_sky_clouds_vbuffer_pos).Value(i) });
		render_set_uniform_int(/*"uIsSky"*/ STR(2541), IntType(0));
		render_set_uniform(/*"uLightSpecular"*/ STR(2542), global::render_light_specular_strength);
		if (!(sVar(background_fog_show) > 0) || !(sVar(background_fog_sky) > 0))
			render_set_uniform(/*"uFogShow"*/ STR(1925), global::_app->background_fog_show);
		return 0.0;
	}
	
	void render_world_start(VarType zfar)
	{
		if (zfar != VarType())
			global::cam_far = min({ global::cam_far_prev, global::cam_near + zfar });
		else
			global::cam_far = global::cam_far_prev;
		
		gpu_set_ztestenable(true);
		render_set_projection(global::cam_from, global::cam_to, global::cam_up, global::cam_fov, global::render_ratio, global::cam_near, global::cam_far);
		global::proj_from = global::cam_from;
		global::render_proj_from = global::proj_from;
		global::proj_matrix = matrix_get(matrix_projection);
		global::view_matrix = matrix_get(matrix_view);
		global::view_proj_matrix = matrix_multiply(global::view_matrix, global::proj_matrix);
		global::proj_depth_near = global::cam_near;
		global::proj_depth_far = global::cam_far;
	}
	
	void render_world_start_light(VarType from, VecType to, VecType offset, IntType tl)
	{
		global::render_light_from = from;
		global::render_light_to = to;
		global::render_light_offset = offset;
		global::render_light_near = IntType(1);
		global::render_light_far = ObjType(obj_timeline, tl)->value.Value(e_value_LIGHT_RANGE);
		global::render_light_color = ObjType(obj_timeline, tl)->value.Value(e_value_LIGHT_COLOR);
		global::render_light_strength = ObjType(obj_timeline, tl)->value.Value(e_value_LIGHT_STRENGTH);
		global::render_light_specular_strength = ObjType(obj_timeline, tl)->value.Value(e_value_LIGHT_SPECULAR_STRENGTH);
		global::render_light_size = ObjType(obj_timeline, tl)->value.Value(e_value_LIGHT_SIZE);
		global::render_light_fade_size = ObjType(obj_timeline, tl)->value.Value(e_value_LIGHT_FADE_SIZE);
		if (ObjType(obj_timeline, tl)->type == e_tl_type_POINT_LIGHT)
		{
			global::render_light_fov = IntType(90);
		}
		else
			if (ObjType(obj_timeline, tl)->type == e_tl_type_SPOT_LIGHT)
			{
				global::render_light_fov = ObjType(obj_timeline, tl)->value.Value(e_value_LIGHT_SPOT_RADIUS);
				global::render_light_spot_sharpness = ObjType(obj_timeline, tl)->value.Value(e_value_LIGHT_SPOT_SHARPNESS);
			}
		
		gpu_set_ztestenable(true);
		if (ObjType(obj_timeline, tl)->type == e_tl_type_SPOT_LIGHT)
		{
			render_set_projection(global::render_light_from, global::render_light_to, vec3(IntType(0), IntType(0), IntType(1)), global::render_light_fov, IntType(1), IntType(1), global::render_light_far);
			global::spot_proj_matrix = matrix_get(matrix_projection);
			global::spot_view_matrix = matrix_get(matrix_view);
			global::spot_view_proj_matrix = matrix_multiply(global::spot_view_matrix, global::spot_proj_matrix);
			global::render_spot_matrix = global::spot_view_proj_matrix;
		}
		render_set_projection(point3D_add(global::render_light_from, global::render_light_offset), point3D_add(global::render_light_to, global::render_light_offset), vec3(IntType(0), IntType(0), IntType(1)), global::render_light_fov, IntType(1), IntType(1), global::render_light_far);
		global::render_proj_from = point3D_add(global::render_light_from, global::render_light_offset);
		global::render_shadow_from = global::render_proj_from;
		global::light_proj_matrix = matrix_get(matrix_projection);
		global::light_view_matrix = matrix_get(matrix_view);
		global::light_view_proj_matrix = matrix_multiply(global::light_view_matrix, global::light_proj_matrix);
		global::proj_depth_near = global::render_light_near;
		global::proj_depth_far = global::render_light_far;
		global::render_shadow_matrix = global::light_view_proj_matrix;
	}
	
	void render_world_start_sun(IntType cascade)
	{
		global::render_sun_near = ObjType(frustum, global::render_cascades.Value(cascade))->near_;
		global::render_sun_far = ObjType(frustum, global::render_cascades.Value(cascade))->far_;
		global::render_light_fov = IntType(45);
		global::render_light_color = global::_app->background_sunlight_color_final;
		global::render_light_strength = global::_app->background_sunlight_strength;
		global::render_light_specular_strength = IntType(1);
		gpu_set_ztestenable(true);
		camera_set_view_mat(global::cam_render, ObjType(frustum, global::render_cascades.Value(cascade))->matView);
		camera_set_proj_mat(global::cam_render, ObjType(frustum, global::render_cascades.Value(cascade))->matProj);
		camera_apply(global::cam_render);
		update_frustum();
		global::light_proj_matrix = matrix_get(matrix_projection);
		global::light_view_matrix = matrix_get(matrix_view);
		global::light_view_proj_matrix = matrix_multiply(global::light_view_matrix, global::light_proj_matrix);
		global::render_sun_matrix = global::light_view_proj_matrix;
		global::render_sun_direction = global::_app->background_sun_direction;
	}
	
	void render_world_text(VarType vbuffer, VarType tex, VarType facecamera, VarType res, VarType outline)
	{
		if (facecamera > 0)
		{
			MatrixType mat;
			RealType rotx, rotz;
			mat = matrix_get(matrix_world);
			rotx = -point_zdirection(mat.Real(MAT_X), mat.Real(MAT_Y), mat.Real(MAT_Z), global::proj_from.Real(X_), global::proj_from.Real(Y_), global::proj_from.Real(Z_));
			rotz = IntType(90) + point_direction(mat.Real(MAT_X), mat.Real(MAT_Y), global::proj_from.Real(X_), global::proj_from.Real(Y_));
			matrix_world_multiply_pre(matrix_build(0.0, 0.0, 0.0, rotx, 0.0, rotz, 1.0, 1.0, 1.0));
		}
		if (!idBool(res, font_minecraft))
		{
			RealType sca = 8.0 / 48.0;
			matrix_world_multiply_pre(matrix_build(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, sca, 1.0, sca));
		}
		render_set_texture(tex.Value(IntType(0)));
		vbuffer_render({ vbuffer.Value(IntType(0)) });
		if (outline != null_)
		{
			render_set_uniform_color(/*"uBlendColor"*/ STR(1916), outline, global::shader_blend_alpha);
			render_set_texture(tex.Value(IntType(1)));
			vbuffer_render({ vbuffer.Value(IntType(1)) });
			render_set_uniform_color(/*"uBlendColor"*/ STR(1916), global::shader_blend_color, global::shader_blend_alpha);
		}
	}
	
	RealType render_world_tl(ScopeAny self)
	{
		if (sVar(type) == e_tl_type_CHARACTER || sVar(type) == e_tl_type_SPECIAL_BLOCK || sVar(type) == e_tl_type_FOLDER || sVar(type) == e_tl_type_BACKGROUND || sVar(type) == e_tl_type_AUDIO || sVar(type) == e_tl_type_PATH_POINT)
			return IntType(0);
		if (sVar(type) == e_tl_type_MODEL && (idVar(sVar(temp), model) == null_ || idInt(idVar(sVar(temp), model), model_format) == e_model_format_MIMODEL))
			return IntType(0);
		if (!global::_app->place_tl_render && (sBool(placed) || sBool(parent_is_placed)))
			return IntType(0);
		if (!sBool(render_visible))
			return IntType(0);
		if ((sVar(glow) > 0 && sVar(only_render_glow) > 0) && global::render_mode != e_render_mode_COLOR_GLOW)
			return IntType(0);
		if (!(sVar(shadows) > 0) && (global::render_mode == e_render_mode_HIGH_LIGHT_SUN_DEPTH || global::render_mode == e_render_mode_HIGH_LIGHT_SPOT_DEPTH || global::render_mode == e_render_mode_HIGH_LIGHT_POINT_DEPTH))
			return IntType(0);
		if (global::render_mode == e_render_mode_CLICK)
		{
			if (sReal(selected) > 0 || sVar(lock) > 0 || !tl_update_list_filter(self->id))
				return IntType(0);
			render_set_uniform_color(/*"uReplaceColor"*/ STR(2537), self->id, IntType(1));
		}
		if (global::render_mode == e_render_mode_SCENE_TEST)
			render_set_uniform_color(/*"uReplaceColor"*/ STR(2537), c_white, IntType(1));
		else
			if (global::render_mode == e_render_mode_SELECT && !sBool(parent_is_selected) && !(sReal(selected) > 0))
				return IntType(0);
			else
				if (global::render_mode == e_render_mode_PLACE && !sBool(parent_is_placed) && !sBool(placed))
					return IntType(0);
		
		
		if (sVar(type) == e_tl_type_PARTICLE_SPAWNER || sVar(type) == e_tl_type_SPOT_LIGHT || sVar(type) == e_tl_type_POINT_LIGHT || sVar(type) == e_tl_type_CAMERA)
		{
			if (global::render_mode == e_render_mode_CLICK)
			{
				render_set_texture(global::shape_texture);
				vbuffer_render({ global::render_click_box, sVar(world_pos) });
			}
			if (sVar(type) != e_tl_type_PARTICLE_SPAWNER)
				return IntType(0);
		}
		if ((sArr(value_inherit).Value(e_value_ALPHA) * IntType(1000)) == IntType(0))
			return IntType(0);
		render_set_culling(!(sVar(backfaces) > 0));
		global::shader_texture_filter_linear = sVar(texture_blur);
		global::shader_texture_filter_mipmap = (global::_app->project_render_texture_filtering > 0 && sVar(texture_filtering) > 0);
		global::shader_blend_color = sArr(value_inherit).Value(e_value_RGB_MUL);
		global::shader_blend_alpha = sArr(value_inherit).Value(e_value_ALPHA);
		render_set_uniform_color(/*"uBlendColor"*/ STR(1916), global::shader_blend_color, global::shader_blend_alpha);
		if (global::render_mode == e_render_mode_AO_MASK)
			render_set_uniform_color(/*"uReplaceColor"*/ STR(2537), (sVar(ssao) > 0) ? c_white : c_black, IntType(1));
		if (sBool(colors_ext) != global::shader_uniform_color_ext || sArr(value_inherit).Value(e_value_RGB_ADD) != global::shader_uniform_rgb_add || sArr(value_inherit).Value(e_value_HSB_ADD) != global::shader_uniform_hsb_add || sArr(value_inherit).Value(e_value_RGB_SUB) != global::shader_uniform_rgb_sub || sArr(value_inherit).Value(e_value_HSB_SUB) != global::shader_uniform_hsb_sub || sArr(value_inherit).Value(e_value_HSB_MUL) != global::shader_uniform_hsb_mul || sArr(value_inherit).Value(e_value_MIX_COLOR) != global::shader_uniform_mix_color || sArr(value_inherit).Value(e_value_MIX_PERCENT) != global::shader_uniform_mix_percent)
		{
			global::shader_uniform_color_ext = sBool(colors_ext);
			global::shader_uniform_rgb_add = sArr(value_inherit).Value(e_value_RGB_ADD);
			global::shader_uniform_hsb_add = sArr(value_inherit).Value(e_value_HSB_ADD);
			global::shader_uniform_rgb_sub = sArr(value_inherit).Value(e_value_RGB_SUB);
			global::shader_uniform_hsb_sub = sArr(value_inherit).Value(e_value_HSB_SUB);
			global::shader_uniform_hsb_mul = sArr(value_inherit).Value(e_value_HSB_MUL);
			global::shader_uniform_mix_color = sArr(value_inherit).Value(e_value_MIX_COLOR);
			global::shader_uniform_mix_percent = sArr(value_inherit).Value(e_value_MIX_PERCENT);
			render_set_uniform_int(/*"uColorsExt"*/ STR(2082), global::shader_uniform_color_ext);
			render_set_uniform_color(/*"uRGBAdd"*/ STR(2083), global::shader_uniform_rgb_add, IntType(1));
			render_set_uniform_color(/*"uHSBAdd"*/ STR(2085), global::shader_uniform_hsb_add, IntType(1));
			render_set_uniform_color(/*"uRGBSub"*/ STR(2084), global::shader_uniform_rgb_sub, IntType(1));
			render_set_uniform_color(/*"uHSBSub"*/ STR(2086), global::shader_uniform_hsb_sub, IntType(1));
			render_set_uniform_color(/*"uHSBMul"*/ STR(2087), global::shader_uniform_hsb_mul, IntType(1));
			render_set_uniform_color(/*"uMixColor"*/ STR(2088), global::shader_uniform_mix_color, global::shader_uniform_mix_percent);
		}
		if (!global::render_alpha_hash_force)
		{
			global::render_alpha_hash = (sVar(alpha_mode) == e_alpha_mode_DEFAULT ? global::_app->project_render_alpha_mode : sVar(alpha_mode));
			render_set_uniform_int(/*"uAlphaHash"*/ STR(1933), global::render_alpha_hash);
		}
		if (sArr(value_inherit).Value(e_value_EMISSIVE) != global::shader_uniform_emissive)
		{
			global::shader_uniform_emissive = sArr(value_inherit).Value(e_value_EMISSIVE);
			render_set_uniform(/*"uEmissive"*/ STR(2535), global::shader_uniform_emissive);
		}
		if (sArr(value_inherit).Value(e_value_METALLIC) != global::shader_uniform_metallic)
		{
			global::shader_uniform_metallic = sArr(value_inherit).Value(e_value_METALLIC);
			render_set_uniform(/*"uMetallic"*/ STR(2533), global::shader_uniform_metallic);
		}
		if (sArr(value_inherit).Value(e_value_ROUGHNESS) != global::shader_uniform_roughness)
		{
			global::shader_uniform_roughness = sArr(value_inherit).Value(e_value_ROUGHNESS);
			render_set_uniform(/*"uRoughness"*/ STR(2534), global::shader_uniform_roughness);
		}
		if (sVar(wind) != global::shader_uniform_wind)
		{
			global::shader_uniform_wind = sVar(wind);
			render_set_uniform(/*"uWindEnable"*/ STR(1918), global::shader_uniform_wind);
		}
		if (sVar(wind_terrain) != global::shader_uniform_wind_terrain)
		{
			global::shader_uniform_wind_terrain = sVar(wind_terrain);
			render_set_uniform(/*"uWindTerrain"*/ STR(1919), global::shader_uniform_wind_terrain);
		}
		if ((global::_app->background_fog_show > 0 && sVar(fog) > 0) != global::shader_uniform_fog)
		{
			global::shader_uniform_fog = (global::_app->background_fog_show > 0 && sVar(fog) > 0);
			render_set_uniform_int(/*"uFogShow"*/ STR(1925), global::shader_uniform_fog);
		}
		if (sArr(value_inherit).Value(e_value_SUBSURFACE) != global::shader_uniform_sss || sArr(value_inherit).Value(e_value_SUBSURFACE_RADIUS_RED) != global::shader_uniform_sss_red || sArr(value_inherit).Value(e_value_SUBSURFACE_RADIUS_GREEN) != global::shader_uniform_sss_green || sArr(value_inherit).Value(e_value_SUBSURFACE_RADIUS_BLUE) != global::shader_uniform_sss_blue || sArr(value_inherit).Value(e_value_SUBSURFACE_COLOR) != global::shader_uniform_sss_color)
		{
			global::shader_uniform_sss = sArr(value_inherit).Value(e_value_SUBSURFACE);
			global::shader_uniform_sss_red = sArr(value_inherit).Value(e_value_SUBSURFACE_RADIUS_RED);
			global::shader_uniform_sss_green = sArr(value_inherit).Value(e_value_SUBSURFACE_RADIUS_GREEN);
			global::shader_uniform_sss_blue = sArr(value_inherit).Value(e_value_SUBSURFACE_RADIUS_BLUE);
			global::shader_uniform_sss_color = sArr(value_inherit).Value(e_value_SUBSURFACE_COLOR);
			render_set_uniform(/*"uSSS"*/ STR(2543), global::shader_uniform_sss);
			render_set_uniform_vec3(/*"uSSSRadius"*/ STR(2544), global::shader_uniform_sss_red, global::shader_uniform_sss_green, global::shader_uniform_sss_blue);
			render_set_uniform_color(/*"uSSSColor"*/ STR(2545), global::shader_uniform_sss_color, 1.0);
		}
		if (sArr(value_inherit).Value(e_value_WIND_INFLUENCE) != global::shader_uniform_wind_strength)
		{
			global::shader_uniform_wind_strength = global::_app->background_wind_strength * (IntType)global::_app->setting_wind_enable * sArr(value_inherit).Value(e_value_WIND_INFLUENCE);
			render_set_uniform(/*"uWindStrength"*/ STR(1921), global::shader_uniform_wind_strength);
			render_set_uniform(/*"uWindDirectionalStrength"*/ STR(1924), global::shader_uniform_wind_strength * global::_app->background_wind_directional_strength);
		}
		IntType prevblend = null_;
		if (sVar(blend_mode) != /*"normal"*/ STR(601) && (global::render_mode == e_render_mode_COLOR || global::render_mode == e_render_mode_COLOR_FOG || global::render_mode == e_render_mode_COLOR_FOG_LIGHTS || global::render_mode == e_render_mode_ALPHA_FIX))
		{
			if (global::render_mode == e_render_mode_ALPHA_FIX)
				return IntType(0);
			prevblend = gpu_get_blendmode();
			VarType blend = DsMap(global::blend_mode_map).Value(sVar(blend_mode));
			if (is_array(blend))
				gpu_set_blendmode_ext(blend.Value(IntType(0)), blend.Value(IntType(1)));
			else
				gpu_set_blendmode((IntType)(blend));
			
		}
		if (sVar(glow) != global::shader_uniform_glow || sVar(glow_texture) != global::shader_uniform_glow_texture || sArr(value_inherit).Value(e_value_GLOW_COLOR) != global::shader_uniform_glow_color)
		{
			global::shader_uniform_glow = sVar(glow);
			global::shader_uniform_glow_texture = sVar(glow_texture);
			global::shader_uniform_glow_color = sArr(value_inherit).Value(e_value_GLOW_COLOR);
			if (global::shader_uniform_glow > 0)
			{
				render_set_uniform_int(/*"uGlow"*/ STR(2546), IntType(1));
				render_set_uniform_int(/*"uGlowTexture"*/ STR(2540), sVar(glow_texture));
				render_set_uniform_color(/*"uGlowColor"*/ STR(2539), global::shader_uniform_glow_color, IntType(1));
				if (sVar(only_render_glow) > 0)
				{
					prevblend = gpu_get_blendmode();
					gpu_set_blendmode(bm_add);
				}
			}
			else
			{
				render_set_uniform_int(/*"uGlow"*/ STR(2546), IntType(0));
				render_set_uniform_int(/*"uGlowTexture"*/ STR(2540), IntType(0));
				render_set_uniform_color(/*"uGlowColor"*/ STR(2539), c_black, IntType(0));
			}
			
		}
		VarType tex;
		RealType spd;
		if (idVar(sVar(glint_tex), texture) > 0)
			tex = idVar(sVar(glint_tex), texture);
		else
			tex = (sVar(glint_mode) == e_glint_ITEM ? idInt(sVar(glint_tex), glint_item_texture) : idInt(sVar(glint_tex), glint_entity_texture));
		
		if (DsMap(idInt(global::render_shader_obj, uniform_map)).Value(/*"uGlintEnabled"*/ STR(2547)) > -IntType(1))
			texture_set_stage(DsMap(idInt(global::render_shader_obj, sampler_map)).Value(/*"uGlintTexture"*/ STR(2548)), sprite_get_texture((IntType)(tex), IntType(0)));
		spd = global::_app->background_time * sVar(glint_speed) * global::_app->project_render_glint_speed;
		render_set_uniform_int(/*"uGlintEnabled"*/ STR(2547), sVar(glint_mode) == e_glint_NONE ? IntType(0) : IntType(1));
		render_set_uniform_vec2(/*"uGlintOffset"*/ STR(2549), spd * (0.000625), spd * (0.00125));
		render_set_uniform(/*"uGlintStrength"*/ STR(2550), global::_app->project_render_glint_strength * sVar(glint_strength));
		render_set_uniform_vec2(/*"uGlintSize"*/ STR(2551), sprite_get_width((IntType)(tex)) * IntType(2) * sVar(glint_scale), sprite_get_height((IntType)(tex)) * IntType(2) * sVar(glint_scale));
		if (sVar(type) != e_tl_type_PARTICLE_SPAWNER)
		{
			matrix_set(matrix_world, sMat(matrix_render));
			if (sVar(type) != e_tl_type_SCENERY && sVar(type) != e_tl_type_BLOCK)
			{
				render_set_texture(ID_spr_default_material, /*"Material"*/ STR(2531));
				render_set_texture(ID_spr_default_normal, /*"Normal"*/ STR(2532));
			}
			switch ((IntType)sVar(type))
			{
				case e_tl_type_BODYPART:
				{
					if (sVar(model_part) == null_ || sVar(render_res_diffuse) == null_)
						break;
					render_world_model_part(self, sVar(model_part), sVar(render_res_diffuse), idInt(sVar(temp), model_texture_name_map), sInt(model_shape_vbuffer_map), idInt(sVar(temp), model_color_map), idInt(sVar(temp), model_shape_hide_list), idInt(sVar(temp), model_shape_texture_name_map), self->id);
					break;
				}
				
				case e_tl_type_SCENERY:
				case e_tl_type_BLOCK:
				{
					if (sVar(type) == e_tl_type_BLOCK)
						render_world_block(idVar(sVar(temp), block_vbuffer), ArrType::From({ sVar(render_res_diffuse), sVar(render_res_material), sVar(render_res_normal) }), true, (idVar(sVar(temp), block_repeat_enable) > 0) ? idVar(sVar(temp), block_repeat) : VarType(vec3(IntType(1))), sVar(temp));
					else
						if (idVar(sVar(temp), scenery) > 0)
							render_world_scenery(self, idVar(sVar(temp), scenery), ArrType::From({ sVar(render_res_diffuse), sVar(render_res_material), sVar(render_res_normal) }), idVar(sVar(temp), block_repeat_enable), idVar(sVar(temp), block_repeat));
					
					break;
				}
				
				case e_tl_type_ITEM:
				{
					if (sVar(item_vbuffer) == null_)
						render_world_item(idVar(sVar(temp), item_vbuffer), idVar(sVar(temp), item_3d), idVar(sVar(temp), item_face_camera), idVar(sVar(temp), item_bounce), idVar(sVar(temp), item_spin), ArrType::From({ sVar(item_res), sVar(item_material_res), sVar(item_normal_res) }));
					else
						render_world_item(sVar(item_vbuffer), idVar(sVar(temp), item_3d), idVar(sVar(temp), item_face_camera), idVar(sVar(temp), item_bounce), idVar(sVar(temp), item_spin), ArrType::From({ sVar(item_res), sVar(item_material_res), sVar(item_normal_res) }));
					
					break;
				}
				
				case e_tl_type_TEXT:
				{
					VarType font = sVar(value).Value(e_value_TEXT_FONT);
					if (font == null_)
						font = idVar(sVar(temp), text_font);
					render_world_text(sVar(text_vbuffer), sVar(text_texture), idVar(sVar(temp), text_face_camera), sVar(text_res), (sVar(value).Value(e_value_TEXT_OUTLINE) > 0) ? sVar(value).Value(e_value_TEXT_OUTLINE_COLOR) : VarType(null_));
					break;
				}
				
				case e_tl_type_MODEL:
				{
					if (idVar(sVar(temp), model) != null_)
					{
						VarType res = sArr(value_inherit).Value(e_value_TEXTURE_OBJ);
						if (res == null_)
							res = idVar(sVar(temp), model_tex);
						if (res == null_ || idInt(res, block_sheet_texture) == null_)
							res = global::mc_res;
						render_world_block(idVar(idVar(sVar(temp), model), block_vbuffer), res);
						withOne (Object, sVar(temp), self->id)
							res = temp_get_model_texobj(self, idArr(self.otherId, value_inherit).Value(e_value_TEXTURE_OBJ));
						
						render_world_block_map(idInt(idVar(sVar(temp), model), model_block_map), res);
					}
					break;
				}
				
				case e_tl_type_PATH:
				{
					if (sVar(path_vbuffer) != null_)
					{
						VarType tex, texmat, texnorm;
						if (sArr(value_inherit).Value(e_value_TEXTURE_OBJ) == null_)
							tex = ID_spr_shape;
						else
							tex = idVar(sArr(value_inherit).Value(e_value_TEXTURE_OBJ), texture);
						
						if (sArr(value_inherit).Value(e_value_TEXTURE_MATERIAL_OBJ) == null_)
						{
							texmat = ID_spr_default_material;
							render_set_uniform_int(/*"uMaterialFormat"*/ STR(2530), e_material_FORMAT_NONE);
						}
						else
						{
							texmat = idVar(sArr(value_inherit).Value(e_value_TEXTURE_MATERIAL_OBJ), texture);
							render_set_uniform_int(/*"uMaterialFormat"*/ STR(2530), idVar(sArr(value_inherit).Value(e_value_TEXTURE_MATERIAL_OBJ), material_format));
						}
						
						if (sArr(value_inherit).Value(e_value_TEXTURE_NORMAL_OBJ) == null_)
							texnorm = ID_spr_default_normal;
						else
							texnorm = idVar(sArr(value_inherit).Value(e_value_TEXTURE_NORMAL_OBJ), texture);
						
						render_set_texture(tex);
						render_set_texture(texmat, /*"Material"*/ STR(2531));
						render_set_texture(texnorm, /*"Normal"*/ STR(2532));
						vbuffer_render({ sVar(path_vbuffer) });
					}
					else
						if (global::render_mode == e_render_mode_CLICK)
						{
							render_set_texture(ID_spr_shape);
							render_set_texture(ID_spr_default_material, /*"Material"*/ STR(2531));
							render_set_texture(ID_spr_default_normal, /*"Normal"*/ STR(2532));
							render_set_uniform_int(/*"uMaterialFormat"*/ STR(2530), e_material_FORMAT_NONE);
							vbuffer_render({ sVar(path_select_vbuffer) });
						}
					
					break;
				}
				
				default:
				{
					VarType tex, matres, texmat, normtex;
					withOne (Object, sVar(temp), self->id)
					{
						tex = temp_get_shape_tex(temp_get_shape_texobj(self, idArr(self.otherId, value_inherit).Value(e_value_TEXTURE_OBJ)));
						matres = temp_get_shape_tex_material_obj(self, idArr(self.otherId, value_inherit).Value(e_value_TEXTURE_MATERIAL_OBJ));
						texmat = temp_get_shape_tex(matres, ID_spr_default_material);
						normtex = temp_get_shape_tex(temp_get_shape_tex_normal_obj(self, idArr(self.otherId, value_inherit).Value(e_value_TEXTURE_NORMAL_OBJ)), ID_spr_default_normal);
						if (matres != null_)
							render_set_uniform_int(/*"uMaterialFormat"*/ STR(2530), idVar(matres, material_format));
						else
							render_set_uniform_int(/*"uMaterialFormat"*/ STR(2530), e_material_FORMAT_NONE);
						
					}
					
					render_world_shape(idVar(sVar(temp), type), idVar(sVar(temp), shape_vbuffer), idVar(sVar(temp), shape_face_camera), ArrType::From({ tex, texmat, normtex }));
					break;
				}
			}
			
		}
		else
			if (global::render_particles > 0)
			{
				for (IntType p = IntType(0); p < ds_list_size(sInt(particle_list)); p++)
					withOne (obj_particle, DsList(sInt(particle_list)).Value(p), self->id)
						render_world_particle(ScopeAny(self));
				
			}
		
		matrix_world_reset();
		global::shader_texture_surface = false;
		if (prevblend != null_)
			gpu_set_blendmode(prevblend);
		return 0.0;
	}
	
}
